# Cursor AI 开发规则

## 文件命名规则

### 服务器脚本命名（强制规则）
**所有在服务器上运行的脚本文件（.sh, .bash），文件名必须使用英文，禁止使用中文。**

#### 原因
- 编码兼容性：避免 Linux 服务器上的编码问题
- Git 兼容性：避免 Git 处理中文文件名时的编码问题
- 跨平台兼容性：确保在不同系统上都能正常工作

#### 命名规范
- ✅ **正确示例**：
  - `deploy.sh` - 部署脚本
  - `build-frontend.sh` - 构建前端脚本
  - `restart-services.sh` - 重启服务脚本
  - `check-status.sh` - 检查状态脚本
  - `migrate-database.sh` - 数据库迁移脚本

- ❌ **错误示例**：
  - `服务器部署命令.sh` - 包含中文
  - `部署脚本.sh` - 包含中文
  - `重启服务.sh` - 包含中文

#### 脚本文件命名建议
- 使用小写字母和连字符（hyphen）
- 使用描述性的动词开头：`deploy-`, `build-`, `start-`, `stop-`, `restart-`, `check-`, `migrate-`
- 文件名应该清晰表达脚本的功能

#### 示例命名模式
```
deploy.sh                    # 通用部署脚本
deploy-frontend.sh           # 前端部署
deploy-backend.sh            # 后端部署
build-production.sh          # 生产环境构建
restart-api.sh               # 重启 API 服务
check-services.sh            # 检查服务状态
migrate-db.sh                # 数据库迁移
setup-environment.sh         # 环境设置
backup-database.sh           # 数据库备份
```

## 代码规范

### Shell 脚本基本结构
```bash
#!/bin/bash
# 脚本描述（可以使用中文注释）
# Script description (English)

set -e  # 遇到错误立即退出

# 变量定义
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="/opt/luckyred"

# 函数定义
function deploy() {
    echo "Deploying..."
    # 部署逻辑
}

# 主逻辑
main() {
    deploy
}

# 执行主函数
main "$@"
```

## 检查清单

在创建新的服务器脚本前，AI 助手必须确认：

- [ ] 文件名使用英文
- [ ] 文件名使用小写字母和连字符
- [ ] 文件名清晰表达脚本功能
- [ ] 脚本包含适当的注释
- [ ] 脚本包含错误处理（`set -e`）
- [ ] 脚本已添加执行权限说明（`chmod +x`）

## 命令执行规范

### 命令格式要求
**所有提供给用户的命令必须包含完整信息：**

1. **明确执行位置**：
   - 必须明确说明是在**本地**还是**服务器**执行
   - 如果是服务器，必须说明是哪个服务器（例如：`ubuntu@10-11-156-159`）
   - 如果是本地，说明是 Windows PowerShell 还是其他环境

2. **包含拉取代码步骤**：
   - 所有需要最新代码的命令，必须包含 `git pull origin master` 步骤
   - 除非明确说明代码已经在最新状态

3. **优先使用一键化指令**：
   - 优先提供一键执行的脚本或命令
   - 使用 `&&` 或脚本文件组合多个步骤
   - 示例：
     ```bash
     cd /opt/luckyred && git pull origin master && python3 scripts/py/test_all_login_methods.py
     ```

4. **提供备用方案**：
   - 当一键化指令可能出错时，提供分步执行的备用方案
   - 备用方案应该逐步说明，便于排查问题
   - 示例：
     ```bash
     # 如果一键化指令失败，使用以下分步执行：
     # 步骤 1: 进入项目目录
     cd /opt/luckyred
     # 步骤 2: 拉取最新代码
     git pull origin master
     # 步骤 3: 运行测试
     python3 scripts/py/test_all_login_methods.py
     ```

### 命令格式模板

#### 服务器执行（一键化）
```bash
# 在服务器 ubuntu@10-11-156-159 上执行：
cd /opt/luckyred && git pull origin master && [执行命令]
```

#### 服务器执行（分步，备用方案）
```bash
# 在服务器 ubuntu@10-11-156-159 上执行：
# 步骤 1: 进入项目目录
cd /opt/luckyred
# 步骤 2: 拉取最新代码
git pull origin master
# 步骤 3: [执行具体命令]
[执行命令]
```

#### 本地执行（Windows PowerShell）
```powershell
# 在本地 Windows PowerShell 中执行：
cd C:\hbgm001
git pull origin master
[执行命令]
```

### 示例

#### ✅ 正确示例
```bash
# 在服务器 ubuntu@10-11-156-159 上执行：
cd /opt/luckyred && git pull origin master && python3 scripts/py/test_all_login_methods.py

# 如果上述命令失败，使用分步执行：
# 步骤 1: 进入项目目录
cd /opt/luckyred
# 步骤 2: 拉取最新代码
git pull origin master
# 步骤 3: 运行测试脚本
python3 scripts/py/test_all_login_methods.py
```

#### ❌ 错误示例
```bash
# 缺少执行位置说明
python3 scripts/py/test_all_login_methods.py

# 缺少拉取代码步骤
cd /opt/luckyred && python3 scripts/py/test_all_login_methods.py

# 没有备用方案
cd /opt/luckyred && git pull origin master && python3 scripts/py/test_all_login_methods.py
```

## 相关文档

- [开发规范文档](./docs/开发规范.md)

