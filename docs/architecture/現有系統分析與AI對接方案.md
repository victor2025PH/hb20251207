# ğŸ” ç¾æœ‰ç´…åŒ…éŠæˆ²ç³»çµ±åˆ†æèˆ‡ AI å°æ¥æ–¹æ¡ˆ

**æ–‡ä»¶è·¯å¾‘ï¼š** `c:\hbgm001\docs\architecture\ç¾æœ‰ç³»çµ±åˆ†æèˆ‡AIå°æ¥æ–¹æ¡ˆ.md`

---

## ğŸ“Š ç¬¬ä¸€éƒ¨åˆ†ï¼šç¾æœ‰ç³»çµ±åŠŸèƒ½æ¸…å–®

### 1. æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

| æ¨¡çµ„ | åŠŸèƒ½ | å®Œæˆåº¦ | API ç«¯é» |
|------|------|--------|----------|
| **ç”¨æˆ¶ç³»çµ±** | è¨»å†Š/ç™»å…¥ | âœ… 100% | `POST /api/auth/telegram` |
| | å€‹äººè³‡æ–™ | âœ… 100% | `GET /api/users/me` |
| | é¤˜é¡æŸ¥è©¢ | âœ… 100% | `GET /api/wallet/balance` |
| **ç´…åŒ…ç³»çµ±** | ç™¼é€ç´…åŒ… | âœ… 100% | `POST /api/redpackets/create` |
| | é ˜å–ç´…åŒ… | âœ… 100% | `POST /api/redpackets/{uuid}/claim` |
| | ç´…åŒ…åˆ—è¡¨ | âœ… 100% | `GET /api/redpackets/list` |
| | æ‰‹æ°£ç´…åŒ… | âœ… 100% | `packet_type=random` |
| | ç´…åŒ…ç‚¸å½ˆ | âœ… 100% | `packet_type=equal` + `bomb_number` |
| **éŒ¢åŒ…ç³»çµ±** | å……å€¼ç”³è«‹ | âœ… 100% | `POST /api/wallet/deposit` |
| | æç¾ç”³è«‹ | âœ… 100% | `POST /api/wallet/withdraw` |
| | äº¤æ˜“è¨˜éŒ„ | âœ… 100% | `GET /api/wallet/transactions` |
| **å…Œæ›ç³»çµ±** | å¹£ç¨®å…Œæ› | âœ… 100% | `POST /api/exchange` |
| | åŒ¯ç‡æŸ¥è©¢ | âœ… 100% | `GET /api/exchange/rate` |
| **ç°½åˆ°ç³»çµ±** | æ¯æ—¥ç°½åˆ° | âœ… 100% | `POST /api/checkin/{tg_id}` |
| | ç°½åˆ°ç‹€æ…‹ | âœ… 100% | `GET /api/checkin/status/{tg_id}` |
| **ç¾¤çµ„ç®¡ç†** | ç¾¤çµ„åˆ—è¡¨ | âœ… 100% | `GET /api/v1/chats` |
| **æ¶ˆæ¯ç³»çµ±** | æ¶ˆæ¯åˆ—è¡¨ | âœ… 100% | `GET /api/v1/messages` |
| **ç®¡ç†å¾Œå°** | ç”¨æˆ¶ç®¡ç† | âœ… 100% | `/api/admin/*` |

### 2. Bot äº¤äº’åŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜ | å®Œæˆåº¦ |
|------|------|--------|
| `/start` | å•Ÿå‹•æ©Ÿå™¨äºº | âœ… 100% |
| `/menu` | ä¸»é¸å–® | âœ… 100% |
| `/wallet` | éŒ¢åŒ…æŸ¥çœ‹ | âœ… 100% |
| `/send` | ç™¼é€ç´…åŒ… | âœ… 100% |
| å…§è¯æŒ‰éˆ• | ç´…åŒ…æ“ä½œæŒ‰éˆ• | âœ… 100% |
| åº•éƒ¨éµç›¤ | å¿«æ·æ“ä½œ | âœ… 100% |
| ç´…åŒ…é ˜å–å›èª¿ | `claim:{uuid}` | âœ… 100% |

### 3. MiniApp å‰ç«¯é é¢

| é é¢ | åŠŸèƒ½ | è·¯å¾‘ |
|------|------|------|
| `SendRedPacket.tsx` | ç™¼é€ç´…åŒ… | `/send` |
| `PacketsPage.tsx` | ç´…åŒ…åˆ—è¡¨ | `/packets` |
| `WalletPage.tsx` | éŒ¢åŒ… | `/wallet` |
| `Recharge.tsx` | å……å€¼ | `/recharge` |
| `Withdraw.tsx` | æç¾ | `/withdraw` |
| `ExchangePage.tsx` | å…Œæ› | `/exchange` |
| `ProfilePage.tsx` | å€‹äººè³‡æ–™ | `/profile` |
| `EarnPage.tsx` | è³ºå– | `/earn` |
| `GamePage.tsx` | éŠæˆ² | `/game` |
| `LuckyWheelPage.tsx` | å¹¸é‹è½‰ç›¤ | `/wheel` |

---

## ğŸ”„ ç¬¬äºŒéƒ¨åˆ†ï¼šæ–°å¯¦æ–½è¨ˆåŠƒèˆ‡ç¾æœ‰ç³»çµ±çš„é—œä¿‚

### æ¶æ§‹å°æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç¾æœ‰ç³»çµ± vs æ–°è¨ˆåŠƒ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€ç¾æœ‰ç³»çµ±ã€‘                    ã€æ–°è¨ˆåŠƒ (V2)ã€‘                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Telegram    â”‚ â”€â”€æ“´å±•â”€â”€â†’     â”‚ Telegram +  â”‚                â”‚
â”‚  â”‚ ç”¨æˆ¶        â”‚                â”‚ Web/WhatsAppâ”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ ç›´æ¥é¤˜é¡    â”‚ â”€â”€å‡ç´šâ”€â”€â†’     â”‚ è¤‡å¼è¨˜å¸³    â”‚                â”‚
â”‚  â”‚ æ›´æ–°        â”‚                â”‚ å¸³æœ¬ç³»çµ±    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ æ‰‹å‹•åŠ å¯†    â”‚ â”€â”€å¢å¼·â”€â”€â†’     â”‚ æ³•å¹£é–˜é“    â”‚                â”‚
â”‚  â”‚ å……å€¼        â”‚                â”‚ è‡ªå‹•è½‰æ›    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ åŸºç¤é‚€è«‹    â”‚ â”€â”€å‡ç´šâ”€â”€â†’     â”‚ è·¨å¹³å°      â”‚                â”‚
â”‚  â”‚ ç³»çµ±        â”‚                â”‚ æ¨è–¦ç³»çµ±    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸŸ¢ ç„¡è¡çªéƒ¨åˆ†ï¼ˆå¯ç›´æ¥è¤‡ç”¨ï¼‰

| ç¾æœ‰åŠŸèƒ½ | æ–°è¨ˆåŠƒå°æ‡‰ | èªªæ˜ |
|---------|-----------|------|
| `POST /api/redpackets/create` | ä¿æŒä¸è®Š | æ ¸å¿ƒç´…åŒ…é‚è¼¯ä¸è®Š |
| `POST /api/redpackets/{uuid}/claim` | ä¿æŒä¸è®Š | é ˜å–é‚è¼¯ä¸è®Š |
| `GET /api/wallet/balance` | æ”¹ç‚ºè®€å– `user_balances` | æ•¸æ“šæºè®ŠåŒ–ï¼ŒAPI ä¸è®Š |
| `POST /api/exchange` | ä¿æŒä¸è®Š | å…Œæ›é‚è¼¯ä¸è®Š |
| Bot handlers | ä¿æŒä¸è®Š | Telegram äº¤äº’ä¸è®Š |
| MiniApp å‰ç«¯ | ä¿æŒä¸è®Š | UI ä¸éœ€ä¿®æ”¹ |

### ğŸŸ¡ éœ€è¦é©é…éƒ¨åˆ†

| ç¾æœ‰åŠŸèƒ½ | é©é…æ–¹å¼ | å„ªå…ˆç´š |
|---------|---------|--------|
| **ç”¨æˆ¶èªè­‰** | å¢åŠ  V2 èªè­‰ç«¯é»ï¼ŒV1 ä¿æŒå…¼å®¹ | é«˜ |
| **é¤˜é¡æ›´æ–°** | åº•å±¤æ”¹ç”¨ LedgerService | ä¸­ |
| **ç´…åŒ…é ˜å–** | é«˜ä¸¦ç™¼å ´æ™¯å¢åŠ  Redis å±¤ | ä½ï¼ˆç¾æœ‰å¯é‹è¡Œï¼‰ |

### ğŸ”µ å…¨æ–°åŠŸèƒ½ï¼ˆä¸å½±éŸ¿ç¾æœ‰ï¼‰

| æ–°åŠŸèƒ½ | èªªæ˜ | ä¾è³´ |
|-------|------|------|
| Web/H5 ç™»å…¥ | Particle Network èªè­‰ | æ–°å¢ |
| æ³•å¹£å……å€¼ | Alchemy Pay æ•´åˆ | æ–°å¢ |
| è·¨å¹³å°æ¨è–¦ | æ¨è–¦é€£çµè¿½è¹¤ | æ–°å¢ |
| PWA æ”¯æ´ | é›¢ç·šä½¿ç”¨ | æ–°å¢ |

---

## ğŸ¤– ç¬¬ä¸‰éƒ¨åˆ†ï¼šAI èŠå¤©ç³»çµ±å°æ¥æ–¹æ¡ˆ

### éœ€æ±‚ç†è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI èŠå¤©ç³»çµ±å°æ¥æ¶æ§‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚   AI èŠå¤©ç³»çµ±    â”‚ â†â”€â”€â”€ ç¬¬ä¸‰æ–¹ Telegram AI Bot               â”‚
â”‚  â”‚  (å¤–éƒ¨ç³»çµ±)      â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚           â”‚ HTTP API èª¿ç”¨                                        â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  ç´…åŒ…éŠæˆ² API é–˜é“                           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚               API Key èªè­‰å±¤                          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ é©—è­‰ AI ç³»çµ±çš„ API Key                             â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ é©—è­‰ä»£è¡¨çš„ Telegram ç”¨æˆ¶                           â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ é€Ÿç‡é™åˆ¶                                           â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚                          â”‚                                  â”‚â”‚
â”‚  â”‚                          â–¼                                  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚               ç´…åŒ…éŠæˆ²æ ¸å¿ƒ API                         â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ ç™¼é€ç´…åŒ…                                           â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ é ˜å–ç´…åŒ…                                           â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ æŸ¥è©¢é¤˜é¡                                           â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ è½‰å¸³                                               â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AI ç³»çµ±å°æ¥ API è¨­è¨ˆ

#### èªè­‰æ–¹å¼

```http
# AI ç³»çµ±èª¿ç”¨æ™‚çš„æ¨™é ­
Authorization: Bearer <API_KEY>
X-Telegram-User-Id: <telegram_user_id>  # ä»£è¡¨çš„ç”¨æˆ¶
X-AI-System-Id: <ai_system_id>          # AI ç³»çµ±æ¨™è­˜
```

#### æ–°å¢ API ç«¯é»ï¼ˆå°ˆç‚º AI ç³»çµ±è¨­è¨ˆï¼‰

```
/api/v2/ai/                           # AI å°ˆç”¨ç«¯é»å‰ç¶´

# ç”¨æˆ¶æ“ä½œï¼ˆAI ä»£æ›¿ç”¨æˆ¶åŸ·è¡Œï¼‰
POST   /api/v2/ai/packets/send        # ç™¼é€ç´…åŒ…
POST   /api/v2/ai/packets/claim       # é ˜å–ç´…åŒ…
GET    /api/v2/ai/wallet/balance      # æŸ¥è©¢é¤˜é¡
POST   /api/v2/ai/wallet/transfer     # å…§éƒ¨è½‰å¸³
GET    /api/v2/ai/user/profile        # ç²å–ç”¨æˆ¶è³‡æ–™

# AI ç³»çµ±ç®¡ç†
POST   /api/v2/ai/register            # è¨»å†Š AI ç³»çµ±ï¼ˆç²å– API Keyï¼‰
GET    /api/v2/ai/status              # API å¥åº·æª¢æŸ¥
GET    /api/v2/ai/usage               # ä½¿ç”¨é‡çµ±è¨ˆ
```

---

## ğŸ“ ç¬¬å››éƒ¨åˆ†ï¼šAI å°æ¥ API è©³ç´°è¦æ ¼

### 4.1 ç™¼é€ç´…åŒ…

```http
POST /api/v2/ai/packets/send
Authorization: Bearer <API_KEY>
X-Telegram-User-Id: 123456789
Content-Type: application/json

{
  "currency": "usdt",
  "packet_type": "random",        // random | equal (bomb)
  "total_amount": 10.0,
  "total_count": 5,
  "message": "AI é€çš„ç´…åŒ…ï¼ğŸ¤–",
  "chat_id": -1001234567890,       // å¯é¸ï¼šç›®æ¨™ç¾¤çµ„
  "bomb_number": null              // ç‚¸å½ˆç´…åŒ…æ™‚å¿…å¡« (0-9)
}
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "data": {
    "packet_id": "uuid-xxx",
    "share_url": "https://t.me/bot/app?startapp=p_uuid",
    "deep_link": "https://app.site.com/packets/uuid",
    "remaining_balance": 90.0,
    "message_sent_to_group": true
  }
}
```

### 4.2 é ˜å–ç´…åŒ…

```http
POST /api/v2/ai/packets/claim
Authorization: Bearer <API_KEY>
X-Telegram-User-Id: 987654321
Content-Type: application/json

{
  "packet_uuid": "uuid-xxx"
}
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "data": {
    "claimed_amount": 2.5,
    "is_luckiest": false,
    "is_bomb": false,
    "penalty_amount": 0,
    "new_balance": 102.5,
    "message": "æ­å–œç²å¾— 2.5 USDTï¼"
  }
}
```

### 4.3 æŸ¥è©¢é¤˜é¡

```http
GET /api/v2/ai/wallet/balance
Authorization: Bearer <API_KEY>
X-Telegram-User-Id: 123456789
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "data": {
    "user_id": 123456789,
    "balances": {
      "usdt": 100.0,
      "ton": 5.0,
      "stars": 1000,
      "points": 500
    },
    "total_usdt_equivalent": 125.0
  }
}
```

### 4.4 å…§éƒ¨è½‰å¸³

```http
POST /api/v2/ai/wallet/transfer
Authorization: Bearer <API_KEY>
X-Telegram-User-Id: 123456789
Content-Type: application/json

{
  "to_user_id": 987654321,        // æ¥æ”¶è€… Telegram ID
  "currency": "usdt",
  "amount": 10.0,
  "note": "AI è½‰å¸³"
}
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "data": {
    "transaction_id": "tx-uuid",
    "from_balance_after": 90.0,
    "to_balance_after": 110.0,
    "message": "æˆåŠŸè½‰å¸³ 10 USDT"
  }
}
```

### 4.5 ç²å–ç”¨æˆ¶è³‡æ–™

```http
GET /api/v2/ai/user/profile
Authorization: Bearer <API_KEY>
X-Telegram-User-Id: 123456789
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "data": {
    "user_id": 123456789,
    "username": "john_doe",
    "first_name": "John",
    "level": 5,
    "xp": 1000,
    "invite_code": "ABC123",
    "packets_sent": 50,
    "packets_claimed": 200,
    "total_sent_amount": 500.0,
    "total_claimed_amount": 300.0
  }
}
```

---

## ğŸ” ç¬¬äº”éƒ¨åˆ†ï¼šAI ç³»çµ±å®‰å…¨æ©Ÿåˆ¶

### 5.1 API Key ç®¡ç†

```python
# æ–°å¢è³‡æ–™è¡¨
class AISystemKey(Base):
    """AI ç³»çµ± API Key"""
    __tablename__ = "ai_system_keys"
    
    id = Column(Integer, primary_key=True)
    system_name = Column(String(64), nullable=False)      # AI ç³»çµ±åç¨±
    api_key_hash = Column(String(128), nullable=False)    # API Key é›œæ¹Š
    
    # æ¬Šé™
    can_send_packets = Column(Boolean, default=True)
    can_claim_packets = Column(Boolean, default=True)
    can_transfer = Column(Boolean, default=False)         # é»˜èªé—œé–‰
    can_view_balance = Column(Boolean, default=True)
    
    # é™åˆ¶
    daily_request_limit = Column(Integer, default=10000)
    per_minute_limit = Column(Integer, default=100)
    max_packet_amount = Column(Numeric(20, 8), default=1000)
    
    # ç™½åå–®ï¼ˆå¯é¸ï¼šé™åˆ¶ä»£è¡¨çš„ç”¨æˆ¶ï¼‰
    allowed_user_ids = Column(JSON, nullable=True)        # [123, 456, ...]
    
    # ç‹€æ…‹
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    last_used_at = Column(DateTime, nullable=True)
```

### 5.2 é€Ÿç‡é™åˆ¶

```python
# Redis é€Ÿç‡é™åˆ¶
RATE_LIMITS = {
    "ai:request:{api_key}:minute": 100,      # æ¯åˆ†é˜ 100 æ¬¡
    "ai:request:{api_key}:hour": 5000,       # æ¯å°æ™‚ 5000 æ¬¡
    "ai:request:{api_key}:day": 50000,       # æ¯å¤© 50000 æ¬¡
    "ai:packet:send:{user_id}:day": 50,      # æ¯ç”¨æˆ¶æ¯å¤©ç™¼ 50 å€‹ç´…åŒ…
    "ai:packet:claim:{user_id}:minute": 10,  # æ¯ç”¨æˆ¶æ¯åˆ†é˜é ˜ 10 å€‹
}
```

### 5.3 å¯©è¨ˆæ—¥èªŒ

```python
class AIApiLog(Base):
    """AI API èª¿ç”¨æ—¥èªŒ"""
    __tablename__ = "ai_api_logs"
    
    id = Column(BigInteger, primary_key=True)
    api_key_id = Column(Integer, ForeignKey("ai_system_keys.id"))
    
    endpoint = Column(String(128), nullable=False)
    method = Column(String(10), nullable=False)
    telegram_user_id = Column(BigInteger, nullable=True)
    
    request_body = Column(JSON, nullable=True)
    response_code = Column(Integer, nullable=False)
    response_body = Column(JSON, nullable=True)
    
    ip_address = Column(String(64), nullable=True)
    execution_time_ms = Column(Integer, nullable=True)
    
    created_at = Column(DateTime, default=datetime.utcnow)
```

---

## ğŸ“‹ ç¬¬å…­éƒ¨åˆ†ï¼šå¯¦æ–½å„ªå…ˆç´š

### éšæ®µ 1ï¼šAI åŸºç¤å°æ¥ï¼ˆ1 é€±ï¼‰

- [ ] å‰µå»º `AISystemKey` è¡¨
- [ ] å¯¦ä½œ API Key èªè­‰ä¸­é–“ä»¶
- [ ] å¯¦ä½œ `/api/v2/ai/wallet/balance` ç«¯é»
- [ ] å¯¦ä½œ `/api/v2/ai/user/profile` ç«¯é»
- [ ] åŸºç¤é€Ÿç‡é™åˆ¶

### éšæ®µ 2ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ1 é€±ï¼‰

- [ ] å¯¦ä½œ `/api/v2/ai/packets/send` ç«¯é»
- [ ] å¯¦ä½œ `/api/v2/ai/packets/claim` ç«¯é»
- [ ] å¯©è¨ˆæ—¥èªŒè¨˜éŒ„
- [ ] éŒ¯èª¤è™•ç†èˆ‡é‡è©¦æ©Ÿåˆ¶

### éšæ®µ 3ï¼šé€²éšåŠŸèƒ½ï¼ˆ1 é€±ï¼‰

- [ ] å¯¦ä½œ `/api/v2/ai/wallet/transfer` ç«¯é»
- [ ] Webhook å›èª¿ï¼ˆç´…åŒ…è¢«é ˜å®Œã€é¤˜é¡è®Šå‹•ç­‰ï¼‰
- [ ] AI ç³»çµ±ç®¡ç†å¾Œå°
- [ ] ä½¿ç”¨é‡çµ±è¨ˆ API

### éšæ®µ 4ï¼šV2 æ¶æ§‹å‡ç´šï¼ˆä¸¦è¡Œï¼‰

- [ ] è³‡æ–™åº«æ¶æ§‹é·ç§»
- [ ] è¤‡å¼è¨˜å¸³ç³»çµ±
- [ ] æ³•å¹£é–˜é“ï¼ˆä¸å½±éŸ¿ AI å°æ¥ï¼‰

---

## ğŸ¯ ç¸½çµ

### ç¾æœ‰ç³»çµ±èˆ‡æ–°è¨ˆåŠƒçš„é—œä¿‚

| ç¶­åº¦ | é—œä¿‚ | èªªæ˜ |
|------|------|------|
| **API å…¼å®¹æ€§** | âœ… å®Œå…¨å…¼å®¹ | V1 API ä¿æŒä¸è®Šï¼Œæ–°å¢ V2 |
| **è³‡æ–™åº«** | âš ï¸ éœ€é·ç§» | æ¼¸é€²å¼é·ç§»ï¼Œä¸ä¸­æ–·æœå‹™ |
| **Bot åŠŸèƒ½** | âœ… ç„¡å½±éŸ¿ | Bot handlers ä¸éœ€ä¿®æ”¹ |
| **MiniApp** | âœ… ç„¡å½±éŸ¿ | å‰ç«¯ API èª¿ç”¨ä¸è®Š |
| **AI å°æ¥** | âœ… ç¨ç«‹æ¨¡çµ„ | æ–°å¢ `/api/v2/ai/*` |

### AI å°æ¥å„ªå‹¢

1. **ç¨ç«‹ API ç©ºé–“** - ä¸å½±éŸ¿ç¾æœ‰ç³»çµ±
2. **å®Œå–„çš„æ¬Šé™æ§åˆ¶** - ç´°ç²’åº¦ API Key æ¬Šé™
3. **å¯©è¨ˆè¿½è¹¤** - æ‰€æœ‰èª¿ç”¨éƒ½æœ‰æ—¥èªŒ
4. **å¯æ“´å±•** - æ”¯æŒå¤šå€‹ AI ç³»çµ±åŒæ™‚å°æ¥

### å»ºè­°ä¸‹ä¸€æ­¥

1. **å„ªå…ˆå¯¦ä½œ AI å°æ¥ API** - ç¨ç«‹æ¨¡çµ„ï¼Œä¸å½±éŸ¿ç¾æœ‰
2. **åŒæ­¥è¦åŠƒ V2 é·ç§»** - ç‚ºæœªä¾†æ“´å±•åšæº–å‚™
3. **æ¸¬è©¦ç’°å¢ƒå…ˆè¡Œ** - AI ç³»çµ±åœ¨æ¸¬è©¦ç’°å¢ƒå°æ¥é©—è­‰
