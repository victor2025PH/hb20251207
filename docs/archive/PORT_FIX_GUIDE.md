# 🔧 端口 8080 問題修復指南

## 錯誤信息
```
[WinError 10013] 以一种访问权限不允许的方式做了一个访问套接字的尝试。
```

這表示端口 8080 被占用或沒有權限使用。

## 快速解決方案

### 方案 1: 使用端口檢查腳本（推薦）

```powershell
.\fix-port-issue.ps1
```

腳本會：
- 檢查端口 8080 是否被占用
- 顯示占用端口的進程
- 提供兩個選項：
  1. 終止占用端口的進程
  2. 使用其他端口（如 8081）

### 方案 2: 手動檢查並釋放端口

```powershell
# 檢查端口占用
netstat -ano | findstr :8080

# 查看進程詳情（替換 PID 為實際進程 ID）
tasklist | findstr <PID>

# 終止進程（替換 PID 為實際進程 ID）
taskkill /PID <PID> /F
```

### 方案 3: 使用不同端口啟動 API

如果無法釋放端口 8080，可以使用其他端口：

```powershell
cd api
.venv\Scripts\Activate.ps1
uvicorn main:app --host 127.0.0.1 --port 8081 --reload
```

**注意**: 如果使用不同端口，需要更新：
- `.env` 文件中的 `API_PORT=8081`
- `.env` 文件中的 `API_BASE_URL=http://localhost:8081`

### 方案 4: 以管理員身份運行

有時需要管理員權限才能使用某些端口：

1. 右鍵點擊 PowerShell
2. 選擇"以管理員身份運行"
3. 重新運行部署腳本

## 已更新的部署腳本

`setup-and-deploy-fixed.ps1` 已更新，會自動：
- 檢測端口 8080 是否可用
- 如果被占用，自動使用端口 8081
- 使用 `127.0.0.1` 而不是 `0.0.0.0`（更安全）

## 驗證修復

修復後，API 服務器應該能夠正常啟動。檢查：

```powershell
# 檢查新端口是否正常
netstat -ano | findstr :8081
```

訪問 API 文檔：
- http://localhost:8080/docs （如果使用 8080）
- http://localhost:8081/docs （如果使用 8081）

## 常見原因

1. **另一個 API 實例正在運行**
   - 檢查是否有其他終端窗口正在運行 uvicorn

2. **其他應用使用端口 8080**
   - 可能是其他開發服務器或應用

3. **Windows 防火牆限制**
   - 檢查防火牆設置

4. **需要管理員權限**
   - 某些端口需要管理員權限

## 預防措施

1. **使用環境變量配置端口**
   ```env
   API_PORT=8081
   ```

2. **在啟動前檢查端口**
   ```powershell
   .\fix-port-issue.ps1
   ```

3. **使用不同的開發端口**
   - 開發環境：8081
   - 測試環境：8082
   - 生產環境：8080
