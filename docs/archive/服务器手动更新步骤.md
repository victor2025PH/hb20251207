# æœåŠ¡å™¨æ‰‹åŠ¨æ›´æ–°æ­¥éª¤

## ğŸ”§ å®Œæ•´æ‰‹åŠ¨æ›´æ–°æµç¨‹

### æ­¥éª¤ 1: è¿æ¥åˆ°æœåŠ¡å™¨

æ‰“å¼€ PowerShell æˆ–ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š

```bash
ssh ubuntu@165.154.254.99
```

è¾“å…¥å¯†ç åè¿›å…¥æœåŠ¡å™¨ã€‚

---

### æ­¥éª¤ 2: æ£€æŸ¥å½“å‰çŠ¶æ€

```bash
# è¿›å…¥åº”ç”¨ç›®å½•
cd /opt/luckyred

# æ£€æŸ¥å½“å‰ Git çŠ¶æ€
git status

# æ£€æŸ¥å½“å‰åˆ†æ”¯
git branch

# æŸ¥çœ‹æœ€æ–°æäº¤
git log -1 --oneline
```

---

### æ­¥éª¤ 3: å¼ºåˆ¶æ‹‰å–æœ€æ–°ä»£ç 

```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd /opt/luckyred

# è·å–è¿œç¨‹æœ€æ–°ä»£ç 
git fetch origin

# æŸ¥çœ‹è¿œç¨‹å’Œæœ¬åœ°çš„å·®å¼‚
git log HEAD..origin/master --oneline

# å¼ºåˆ¶é‡ç½®åˆ°è¿œç¨‹ master åˆ†æ”¯ï¼ˆè¿™ä¼šè¦†ç›–æœ¬åœ°æ‰€æœ‰æ›´æ”¹ï¼‰
git reset --hard origin/master

# æ¸…ç†æœªè·Ÿè¸ªçš„æ–‡ä»¶
git clean -fd

# éªŒè¯ä»£ç å·²æ›´æ–°
git log -1 --oneline
```

**é‡è¦æç¤º**: `git reset --hard` ä¼šè¦†ç›–æ‰€æœ‰æœ¬åœ°æ›´æ”¹ï¼Œè¯·ç¡®ä¿æ²¡æœ‰æœªæäº¤çš„é‡è¦æ›´æ”¹ã€‚

---

### æ­¥éª¤ 4: éªŒè¯ä»£ç æ–‡ä»¶

```bash
# æ£€æŸ¥å¸ç§æ˜¯å¦å·²æ›´æ–°ä¸º Stars
grep -n "'Stars'" frontend/src/pages/SendRedPacket.tsx

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
# 430:            {['USDT', 'TON', 'Stars'].map((c) => (

# å¦‚æœçœ‹åˆ° 'Star' è€Œä¸æ˜¯ 'Stars'ï¼Œè¯´æ˜ä»£ç æ²¡æœ‰æ›´æ–°
```

---

### æ­¥éª¤ 5: æ¸…é™¤å‰ç«¯æ„å»ºç¼“å­˜

```bash
cd /opt/luckyred/frontend

# åˆ é™¤æ—§çš„æ„å»ºæ–‡ä»¶
rm -rf dist

# åˆ é™¤ Vite ç¼“å­˜
rm -rf node_modules/.vite

# å¯é€‰ï¼šå¦‚æœæ„å»ºä¸€ç›´æœ‰é—®é¢˜ï¼Œå¯ä»¥åˆ é™¤æ•´ä¸ª node_modules
# rm -rf node_modules
```

---

### æ­¥éª¤ 6: é‡æ–°å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# å¦‚æœåˆ é™¤äº† node_modulesï¼Œéœ€è¦é‡æ–°å®‰è£…
cd /opt/luckyred/frontend
npm install
```

---

### æ­¥éª¤ 7: é‡æ–°æ„å»ºå‰ç«¯

```bash
cd /opt/luckyred/frontend

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºè¿‡ç¨‹å¯èƒ½éœ€è¦ 2-5 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…
# å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œè¯·è®°å½•é”™è¯¯ä¿¡æ¯
```

**æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ**:
```bash
# æ£€æŸ¥ dist ç›®å½•æ˜¯å¦å­˜åœ¨
ls -lh dist/

# æ£€æŸ¥æ„å»ºæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼ˆåº”è¯¥æ˜¯åˆšåˆšæ„å»ºçš„ï¼‰
ls -lh dist/assets/*.js | head -3
```

---

### æ­¥éª¤ 8: éªŒè¯æ„å»ºæ–‡ä»¶

```bash
# æ£€æŸ¥æ„å»ºæ–‡ä»¶ä¸­æ˜¯å¦åŒ…å« 'Stars'
grep -o 'Stars' dist/assets/*.js | head -5

# å¦‚æœçœ‹åˆ°è¾“å‡ºï¼Œè¯´æ˜æ„å»ºæˆåŠŸ
# å¦‚æœçœ‹åˆ° 'Star' è€Œä¸æ˜¯ 'Stars'ï¼Œè¯´æ˜ä»£ç æœ‰é—®é¢˜
```

---

### æ­¥éª¤ 9: é‡å¯æœåŠ¡

```bash
# å›åˆ°åº”ç”¨æ ¹ç›®å½•
cd /opt/luckyred

# é‡å¯ API æœåŠ¡
sudo systemctl restart luckyred-api

# é‡å¯ Bot æœåŠ¡
sudo systemctl restart luckyred-bot

# é‡æ–°åŠ è½½ Nginx é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
sudo systemctl reload nginx
```

---

### æ­¥éª¤ 10: æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ API æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api

# æ£€æŸ¥ Bot æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-bot

# æ£€æŸ¥ Nginx æœåŠ¡çŠ¶æ€
sudo systemctl status nginx
```

**å¦‚æœæœåŠ¡çŠ¶æ€æ˜¾ç¤º "active (running)"ï¼Œè¯´æ˜æœåŠ¡æ­£å¸¸è¿è¡Œã€‚**

---

### æ­¥éª¤ 11: æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼ˆå¦‚æœ‰é—®é¢˜ï¼‰

å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# API æœåŠ¡æ—¥å¿—
sudo journalctl -u luckyred-api -n 50 --no-pager

# Bot æœåŠ¡æ—¥å¿—
sudo journalctl -u luckyred-bot -n 50 --no-pager

# Nginx é”™è¯¯æ—¥å¿—
sudo tail -n 50 /var/log/nginx/error.log
```

---

## ğŸš€ ä¸€é”®æ›´æ–°è„šæœ¬ï¼ˆæ¨èï¼‰

å¦‚æœä¸Šé¢çš„æ­¥éª¤å¤ªç¹çï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæ›´æ–°è„šæœ¬
cat > /tmp/update-app.sh << 'EOF'
#!/bin/bash
set -e

echo "=========================================="
echo "  å¼€å§‹æ›´æ–°åº”ç”¨..."
echo "=========================================="

cd /opt/luckyred

echo ""
echo "[1/6] æ‹‰å–æœ€æ–°ä»£ç ..."
git fetch origin
git reset --hard origin/master
git clean -fd

echo ""
echo "[2/6] éªŒè¯ä»£ç æ›´æ–°..."
if grep -q "'Stars'" frontend/src/pages/SendRedPacket.tsx; then
    echo "âœ“ ä»£ç å·²æ›´æ–°ä¸º Stars"
else
    echo "âœ— ä»£ç æœªæ›´æ–°ï¼Œè¯·æ£€æŸ¥ Git ä»“åº“"
    exit 1
fi

echo ""
echo "[3/6] æ¸…é™¤æ„å»ºç¼“å­˜..."
cd frontend
rm -rf dist node_modules/.vite

echo ""
echo "[4/6] é‡æ–°æ„å»ºå‰ç«¯..."
npm install --silent
npm run build

echo ""
echo "[5/6] éªŒè¯æ„å»ºæ–‡ä»¶..."
if grep -q "Stars" dist/assets/*.js 2>/dev/null; then
    echo "âœ“ æ„å»ºæ–‡ä»¶åŒ…å« Stars"
else
    echo "âš ï¸  è­¦å‘Šï¼šæ„å»ºæ–‡ä»¶ä¸­æœªæ‰¾åˆ° Stars"
fi

echo ""
echo "[6/6] é‡å¯æœåŠ¡..."
cd ..
sudo systemctl restart luckyred-api
sudo systemctl restart luckyred-bot
sudo systemctl reload nginx

echo ""
echo "=========================================="
echo "  æ›´æ–°å®Œæˆï¼"
echo "=========================================="
echo ""
echo "è¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢æµ‹è¯•"
EOF

# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /tmp/update-app.sh

# æ‰§è¡Œæ›´æ–°è„šæœ¬
/tmp/update-app.sh
```

---

## ğŸ” éªŒè¯æ›´æ–°æ˜¯å¦æˆåŠŸ

### æ–¹æ³• 1: æ£€æŸ¥æ„å»ºæ–‡ä»¶æ—¶é—´

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
ls -lh /opt/luckyred/frontend/dist/assets/*.js | head -3

# æ–‡ä»¶æ—¶é—´åº”è¯¥æ˜¯åˆšåˆšçš„ï¼ˆå‡ åˆ†é’Ÿå†…ï¼‰
```

### æ–¹æ³• 2: æ£€æŸ¥æ„å»ºæ–‡ä»¶å†…å®¹

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
grep -o "Stars" /opt/luckyred/frontend/dist/assets/*.js | head -5

# åº”è¯¥çœ‹åˆ°è¾“å‡ºï¼Œå¦‚æœçœ‹åˆ° 'Star' è¯´æ˜æœ‰é—®é¢˜
```

### æ–¹æ³• 3: åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰
2. å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼ˆCtrl+F5ï¼‰
3. è®¿é—® https://mini.usdt2026.cc/send
4. æ£€æŸ¥å¸ç§æ˜¯å¦æ˜¾ç¤ºä¸º "Stars"ï¼ˆä¸æ˜¯ "Star"ï¼‰

---

## âš ï¸ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1: Git æ‹‰å–å¤±è´¥

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping github.com

# æ£€æŸ¥ Git è¿œç¨‹åœ°å€
git remote -v

# å¦‚æœè¿œç¨‹åœ°å€ä¸å¯¹ï¼Œæ›´æ–°å®ƒ
git remote set-url origin https://github.com/victor2025PH/hongbao20251025.git
```

### é—®é¢˜ 2: æ„å»ºå¤±è´¥

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version
# åº”è¯¥æ˜¯ v18 æˆ–æ›´é«˜ç‰ˆæœ¬

# æ£€æŸ¥ npm ç‰ˆæœ¬
npm --version

# æ¸…é™¤ npm ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules é‡æ–°å®‰è£…
cd /opt/luckyred/frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### é—®é¢˜ 3: æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u luckyred-api -n 100 --no-pager

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo netstat -tlnp | grep 8080

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /opt/luckyred/.env
```

### é—®é¢˜ 4: å‰ç«¯ä»ç„¶æ˜¾ç¤ºæ—§å†…å®¹

```bash
# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æ£€æŸ¥ Nginx æ˜¯å¦æŒ‡å‘æ­£ç¡®çš„ç›®å½•
sudo grep -r "root" /etc/nginx/sites-enabled/

# åº”è¯¥æŒ‡å‘ /opt/luckyred/frontend/dist

# å¦‚æœä¸å¯¹ï¼Œæ›´æ–° Nginx é…ç½®åé‡æ–°åŠ è½½
sudo systemctl reload nginx
```

---

## ğŸ“ å®Œæ•´å‘½ä»¤åºåˆ—ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

```bash
# è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

cd /opt/luckyred && \
git fetch origin && \
git reset --hard origin/master && \
git clean -fd && \
echo "ä»£ç å·²æ›´æ–°" && \
cd frontend && \
rm -rf dist node_modules/.vite && \
npm install && \
npm run build && \
echo "å‰ç«¯æ„å»ºå®Œæˆ" && \
cd .. && \
sudo systemctl restart luckyred-api && \
sudo systemctl restart luckyred-bot && \
sudo systemctl reload nginx && \
echo "æœåŠ¡å·²é‡å¯" && \
echo "æ›´æ–°å®Œæˆï¼è¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢"
```

---

## âœ… æ›´æ–°æ£€æŸ¥æ¸…å•

æ‰§è¡Œå®Œæ›´æ–°åï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] Git ä»£ç å·²æ‹‰å–åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] ä»£ç æ–‡ä»¶ä¸­åŒ…å« 'Stars'ï¼ˆä¸æ˜¯ 'Star'ï¼‰
- [ ] å‰ç«¯æ„å»ºæˆåŠŸï¼ˆdist ç›®å½•å­˜åœ¨ï¼‰
- [ ] æ„å»ºæ–‡ä»¶ä¸­åŒ…å« 'Stars'
- [ ] API æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] Bot æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] Nginx æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] æµè§ˆå™¨ä¸­æ˜¾ç¤º 'Stars'ï¼ˆæ¸…é™¤ç¼“å­˜åï¼‰

---

**å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåä»ç„¶æ²¡æœ‰æ›´æ–°ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä¼šå¸®æ‚¨è¿›ä¸€æ­¥æ’æŸ¥ã€‚**
