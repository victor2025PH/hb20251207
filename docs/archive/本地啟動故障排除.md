# 本地啟動故障排除指南

## 🔍 問題：ERR_CONNECTION_REFUSED

### 原因分析
`ERR_CONNECTION_REFUSED` 錯誤表示瀏覽器無法連接到 `localhost:3001`，通常有以下原因：

1. **前端服務器未啟動**
2. **端口被其他程序佔用**
3. **依賴未安裝**
4. **防火牆阻止連接**

## ✅ 解決步驟

### 步驟 1: 檢查服務是否正在運行

打開任務管理器（Ctrl + Shift + Esc），查看是否有以下進程：
- `node.exe` (前端服務器)
- `python.exe` (API 服務器)

### 步驟 2: 使用快速啟動腳本

運行以下命令：
```bash
.\快速啟動本地服務.bat
```

或手動啟動：

#### 啟動前端服務器
```bash
cd frontend
npm run dev
```

#### 啟動 API 服務器
```bash
cd api
.venv\Scripts\activate
python main.py
```

### 步驟 3: 檢查端口是否被佔用

在 PowerShell 中運行：
```powershell
# 檢查端口 3001
Get-NetTCPConnection -LocalPort 3001

# 檢查端口 8080
Get-NetTCPConnection -LocalPort 8080
```

如果端口被佔用，可以：
1. 關閉佔用端口的程序
2. 或修改端口配置

### 步驟 4: 檢查依賴是否已安裝

#### 前端依賴
```bash
cd frontend
npm install
```

#### API 依賴
```bash
cd api
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

### 步驟 5: 檢查 Node.js 和 Python 版本

```bash
# 檢查 Node.js 版本（應該 >= 16）
node --version

# 檢查 Python 版本（應該 >= 3.8）
python --version
```

### 步驟 6: 檢查防火牆設置

Windows 防火牆可能會阻止本地連接。如果其他步驟都正常，嘗試：
1. 暫時關閉防火牆測試
2. 或添加防火牆規則允許 Node.js 和 Python

## 🚀 快速啟動命令

### 方式一：使用批處理腳本（推薦）
```bash
.\快速啟動本地服務.bat
```

### 方式二：使用 PowerShell 腳本
```powershell
.\start-local-dev.ps1
```

### 方式三：手動啟動

#### 終端 1 - 前端服務器
```bash
cd c:\hbgm001\frontend
npm run dev
```

#### 終端 2 - API 服務器
```bash
cd c:\hbgm001\api
.venv\Scripts\activate
python main.py
```

## 📋 檢查清單

啟動前請確認：
- [ ] Node.js 已安裝（`node --version`）
- [ ] Python 已安裝（`python --version`）
- [ ] 前端依賴已安裝（`frontend/node_modules` 存在）
- [ ] API 虛擬環境已創建（`api/.venv` 存在）
- [ ] API 依賴已安裝
- [ ] `.env` 文件已配置
- [ ] 端口 3001 和 8080 未被佔用

## 🔧 常見錯誤及解決方法

### 錯誤 1: `npm: command not found`
**解決：** 安裝 Node.js：https://nodejs.org/

### 錯誤 2: `python: command not found`
**解決：** 安裝 Python：https://www.python.org/

### 錯誤 3: `Port 3001 is already in use`
**解決：**
```bash
# 查找佔用端口的進程
netstat -ano | findstr :3001

# 結束進程（替換 PID）
taskkill /PID <PID> /F
```

### 錯誤 4: `Cannot find module 'xxx'`
**解決：**
```bash
cd frontend
rm -rf node_modules
npm install
```

### 錯誤 5: `ModuleNotFoundError: No module named 'xxx'`
**解決：**
```bash
cd api
.venv\Scripts\activate
pip install -r requirements.txt
```

## 📞 如果問題仍然存在

1. **檢查新打開的命令窗口**：查看是否有錯誤信息
2. **查看日誌**：檢查服務器輸出的錯誤信息
3. **檢查 `.env` 文件**：確保配置正確
4. **嘗試其他端口**：修改 `vite.config.ts` 和 `.env` 中的端口配置

## 🎯 驗證服務是否正常

### 檢查前端服務器
在瀏覽器中訪問：http://localhost:3001

### 檢查 API 服務器
在瀏覽器中訪問：http://localhost:8080/docs

如果兩個都能訪問，說明服務正常運行！
