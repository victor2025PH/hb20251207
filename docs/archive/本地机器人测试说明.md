# 本地机器人测试说明

## ✅ 已创建的启动脚本

1. **本地测试机器人.bat** - 双击运行（推荐）
2. **启动本地机器人.ps1** - PowerShell 脚本

## 🚀 启动方法

### 方法 1: 使用批处理文件（最简单）
双击运行 `本地测试机器人.bat`

### 方法 2: 使用 PowerShell 脚本
```powershell
cd c:\hbgm001
.\启动本地机器人.ps1
```

### 方法 3: 手动启动
```powershell
cd c:\hbgm001\bot
.\.venv\Scripts\Activate.ps1
python main.py
```

## 📝 测试步骤

### 1. 确认机器人已启动
- 查看启动窗口，应该看到：
  - `🤖 Bot @username started!`
  - `Bot 正在啟動，準備接收消息...`

### 2. 在 Telegram 中测试
- **重要**：必须在**私聊**中测试，不能在群组中！
- 打开与机器人的私聊
- 发送 `/start` 命令

### 3. 测试按钮功能

#### 测试内联键盘按钮（消息中的绿色按钮）
- 点击 "💰 錢包" → 应该直接打开 miniapp 钱包页面
- 点击 "🧧 紅包" → 应该直接打开 miniapp 红包页面
- 点击 "📈 賺取" → 应该直接打开 miniapp 赚取页面
- 点击 "🎮 遊戲" → 应该直接打开 miniapp 游戏页面
- 点击 "👤 我的" → 应该直接打开 miniapp 个人资料页面

#### 测试回覆键盘按钮（底部键盘）
- 点击 "💰 錢包" → 应该直接打开 miniapp 钱包页面
- 点击 "🧧 紅包" → 应该直接打开 miniapp 红包页面
- 点击 "📈 賺取" → 应该直接打开 miniapp 赚取页面
- 点击 "🎮 遊戲" → 应该直接打开 miniapp 游戏页面
- 点击 "👤 我的" → 应该直接打开 miniapp 个人资料页面
- 点击 "📱 打開應用" → 应该打开 miniapp 主页

#### 测试菜单按钮（输入框左侧）
- 应该显示为：`🎮 打開應用`
- 点击后应该直接打开 miniapp

#### 测试命令
- 输入 `/wallet` → 显示按钮，点击后打开钱包页面
- 输入 `/packets` → 显示按钮，点击后打开红包页面
- 输入 `/earn` → 显示按钮，点击后打开赚取页面
- 输入 `/game` → 显示按钮，点击后打开游戏页面
- 输入 `/profile` → 显示按钮，点击后打开个人资料页面

## ⚠️ 重要提示

1. **必须在私聊中测试**：
   - `web_app` 按钮只在私聊中工作
   - 在群组中不会工作

2. **不会发送文本消息**：
   - 点击 `web_app` 按钮时，不会发送文本消息
   - 而是直接打开 web app
   - 所以 `handle_reply_keyboard` 不会被调用

3. **直接打开 miniapp**：
   - 按钮应该直接打开对应的 miniapp 页面
   - 不需要 bot 处理

4. **如果按钮不工作**：
   - 检查是否在私聊中测试
   - 检查 Telegram 客户端版本（需要 2022年4月16日之后）
   - 检查 `.env` 文件中的 `MINIAPP_URL` 是否正确

## 🔍 检查机器人状态

### 查看日志
启动窗口会显示所有日志，包括：
- Bot 启动信息
- 用户操作日志
- 错误信息

### 检查进程
```powershell
Get-Process python | Where-Object { $_.Path -like "*hbgm001\bot*" }
```

### 停止机器人
- 在启动窗口中按 `Ctrl+C`
- 或关闭启动窗口

## 🐛 常见问题

### 1. 虚拟环境不存在
```powershell
cd c:\hbgm001\bot
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

### 2. 依赖安装失败
```powershell
pip install --upgrade pip
pip install -r requirements.txt
```

### 3. .env 文件不存在
- 从 `.env.example` 复制创建
- 填入正确的 `BOT_TOKEN` 和 `MINIAPP_URL`

### 4. Bot Token 错误
- 检查 `.env` 文件中的 `BOT_TOKEN`
- 确保 token 正确且有效

---

**现在可以在本地测试机器人了！**
