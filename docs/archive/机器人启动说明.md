# 机器人启动说明

## ✅ 已创建的启动脚本

1. **启动机器人-详细.bat** - 详细输出版本（推荐）
2. **在新窗口启动机器人.bat** - 在新窗口运行
3. **快速启动机器人.bat** - 快速启动版本

## 🚀 启动方法

### 方法 1: 双击运行（最简单）
双击运行 `启动机器人-详细.bat`

### 方法 2: 命令行运行
```cmd
cd c:\hbgm001
启动机器人-详细.bat
```

### 方法 3: PowerShell 运行
```powershell
cd c:\hbgm001
.\启动机器人-详细.bat
```

## 📋 启动前检查

### 1. 检查 .env 文件
- 确保 `c:\hbgm001\.env` 文件存在
- 确保文件中包含 `BOT_TOKEN=你的机器人Token`
- 确保文件中包含 `MINIAPP_URL=https://mini.usdt2026.cc`（或你的实际URL）

### 2. 检查 Python
- 确保已安装 Python 3.8 或更高版本
- 在命令行运行 `python --version` 检查

### 3. 检查虚拟环境
- 如果虚拟环境不存在，脚本会自动创建
- 首次运行可能需要几分钟安装依赖

## 📝 启动成功标志

启动成功后，您应该看到：

```
========================================
  Bot 启动中...
========================================

2024-XX-XX XX:XX:XX | INFO     | bot.main:main:XXX - 🚀 Starting Lucky Red Bot
2024-XX-XX XX:XX:XX | INFO     | shared.database.connection:init_db:XXX - ✅ Database initialized
2024-XX-XX XX:XX:XX | INFO     | bot.main:post_init:XXX - Bot commands set up
2024-XX-XX XX:XX:XX | INFO     | bot.main:post_init:XXX - Bot menu button set up (WebApp)
2024-XX-XX XX:XX:XX | INFO     | bot.main:post_init:XXX - 🤖 Bot @your_bot_username started!
2024-XX-XX XX:XX:XX | INFO     | bot.main:main:XXX - Bot 正在啟動，準備接收消息...
```

## ⚠️ 常见问题

### 1. 虚拟环境不存在
**问题**: `虚拟环境不存在，需要创建`
**解决**: 脚本会自动创建，等待完成即可

### 2. 依赖安装失败
**问题**: `pip install` 报错
**解决**: 
- 检查网络连接
- 尝试手动运行: `pip install -r requirements.txt`
- 检查 Python 版本是否 >= 3.8

### 3. BOT_TOKEN 错误
**问题**: `Bot token is invalid` 或 `Unauthorized`
**解决**: 
- 检查 `.env` 文件中的 `BOT_TOKEN` 是否正确
- 确保 token 没有多余的空格
- 从 BotFather 重新获取 token

### 4. 数据库连接失败
**问题**: `Database connection failed`
**解决**: 
- 检查 `.env` 文件中的 `DATABASE_URL` 是否正确
- 确保数据库服务正在运行
- 如果是本地测试，可能需要先启动数据库

### 5. 看不到输出
**问题**: 窗口立即关闭
**解决**: 
- 使用 `启动机器人-详细.bat`（会在最后暂停）
- 或在命令行中运行，不要双击

## 🔍 检查机器人是否运行

### 方法 1: 查看进程
```powershell
Get-Process python | Where-Object { $_.Path -like "*hbgm001\bot*" }
```

### 方法 2: 在 Telegram 中测试
- 打开与机器人的私聊
- 发送 `/start` 命令
- 如果机器人回复，说明运行成功

### 方法 3: 查看日志
- 启动窗口会显示所有日志
- 查看是否有错误信息

## 🛑 停止机器人

### 方法 1: 在启动窗口中
- 按 `Ctrl+C`
- 等待机器人优雅关闭

### 方法 2: 强制停止
```powershell
Get-Process python | Where-Object { $_.Path -like "*hbgm001\bot*" } | Stop-Process -Force
```

## 📞 测试机器人

启动成功后：

1. **在 Telegram 中与机器人私聊**
2. **发送 `/start` 命令**
3. **测试按钮功能**：
   - 点击内联键盘按钮（消息中的绿色按钮）
   - 点击回覆键盘按钮（底部键盘）
   - 点击菜单按钮（输入框左侧的 🎮 打開應用）

## ⚠️ 重要提示

1. **必须在私聊中测试**：`web_app` 按钮只在私聊中工作
2. **不会发送文本消息**：点击 `web_app` 按钮时，不会发送文本消息，而是直接打开 web app
3. **直接打开 miniapp**：按钮应该直接打开对应的 miniapp 页面

---

**现在可以启动机器人了！双击运行 `启动机器人-详细.bat`**
