# æœºå™¨äººæŒ‰é’®æ— å“åº”é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ” é—®é¢˜åˆ†æ

ç”¨æˆ·æŠ¥å‘Šåœ¨æœºå™¨äººä¸­ç‚¹å‡»ä»»ä½•èœå•å’ŒæŒ‰é’®éƒ½æ²¡æœ‰å“åº”ã€‚ç»è¿‡åˆ†æï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

1. **å¼‚å¸¸å¤„ç†ä¸å®Œæ•´**ï¼š`handle_reply_keyboard` å‡½æ•°ç¼ºå°‘å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œå¯¼è‡´ä»»ä½•æœªæ•è·çš„å¼‚å¸¸éƒ½ä¼šå¯¼è‡´å‡½æ•°é™é»˜å¤±è´¥
2. **å›è°ƒå¤„ç†å¼‚å¸¸**ï¼š`menu_callback` å‡½æ•°åœ¨å¤„ç†å†…è”é”®ç›˜å›è°ƒæ—¶ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰ç»™ç”¨æˆ·åé¦ˆ
3. **é”™è¯¯æ¶ˆæ¯ç¼ºå¤±**ï¼šå½“å¤„ç†å¤±è´¥æ—¶ï¼Œç”¨æˆ·æ²¡æœ‰æ”¶åˆ°ä»»ä½•é”™è¯¯æç¤º

## âœ… ä¿®å¤å†…å®¹

### 1. `bot/handlers/keyboard.py`
- âœ… åœ¨ `handle_reply_keyboard` å‡½æ•°å¼€å¤´æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†
- âœ… å½“ç”¨æˆ·æœªæ‰¾åˆ°æ—¶ï¼Œå‘é€æç¤ºæ¶ˆæ¯è€Œä¸æ˜¯é™é»˜è¿”å›
- âœ… åœ¨æœªåŒ¹é…æŒ‰é’®å¤„ç†ä¸­æ·»åŠ å¼‚å¸¸ä¿æŠ¤

### 2. `bot/handlers/menu.py`
- âœ… åœ¨ `menu_callback` å‡½æ•°ä¸­æ·»åŠ å®Œæ•´çš„å¼‚å¸¸å¤„ç†
- âœ… åœ¨ `query.answer()` è°ƒç”¨ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†
- âœ… åœ¨è·å–ç”¨æˆ·ä¿¡æ¯æ—¶æ·»åŠ å¼‚å¸¸å¤„ç†
- âœ… åœ¨å¤„ç†å„ä¸ªèœå•æ“ä½œæ—¶æ·»åŠ å¼‚å¸¸å¤„ç†
- âœ… åœ¨ `show_main_menu` å‡½æ•°ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†

### 3. `bot/main.py`
- âœ… åœ¨ `debug_text_handler` ä¸­æ·»åŠ é”™è¯¯æ¶ˆæ¯å‘é€ï¼Œç¡®ä¿ç”¨æˆ·æ”¶åˆ°åé¦ˆ

## ğŸ“ éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶

### æœåŠ¡å™¨è·¯å¾„ï¼š`/opt/luckyred/`

1. **bot/handlers/keyboard.py**
   - æœ¬åœ°è·¯å¾„ï¼š`C:\hbgm001\bot\handlers\keyboard.py`
   - æœåŠ¡å™¨è·¯å¾„ï¼š`/opt/luckyred/bot/handlers/keyboard.py`

2. **bot/handlers/menu.py**
   - æœ¬åœ°è·¯å¾„ï¼š`C:\hbgm001\bot\handlers\menu.py`
   - æœåŠ¡å™¨è·¯å¾„ï¼š`/opt/luckyred/bot/handlers/menu.py`

3. **bot/main.py**
   - æœ¬åœ°è·¯å¾„ï¼š`C:\hbgm001\bot\main.py`
   - æœåŠ¡å™¨è·¯å¾„ï¼š`/opt/luckyred/bot/main.py`

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1: ä½¿ç”¨ WinSCP ä¸Šä¼ 

1. è¿æ¥åˆ°æœåŠ¡å™¨ï¼š
   - ä¸»æœºåï¼š`165.154.254.99`
   - ç”¨æˆ·åï¼š`ubuntu`
   - å¯†ç ï¼šæ‚¨çš„æœåŠ¡å™¨å¯†ç 

2. ä¸Šä¼ æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•ï¼š
   - `bot/handlers/keyboard.py` â†’ `/opt/luckyred/bot/handlers/keyboard.py`
   - `bot/handlers/menu.py` â†’ `/opt/luckyred/bot/handlers/menu.py`
   - `bot/main.py` â†’ `/opt/luckyred/bot/main.py`

3. SSH è¿æ¥åˆ°æœåŠ¡å™¨å¹¶é‡å¯ botï¼š
   ```bash
   ssh ubuntu@165.154.254.99
   sudo systemctl restart luckyred-bot
   sudo systemctl status luckyred-bot
   ```

### æ–¹æ³• 2: ä½¿ç”¨ SCP ä¸Šä¼ 

```powershell
# åœ¨ PowerShell ä¸­æ‰§è¡Œ
scp C:\hbgm001\bot\handlers\keyboard.py ubuntu@165.154.254.99:/opt/luckyred/bot/handlers/keyboard.py
scp C:\hbgm001\bot\handlers\menu.py ubuntu@165.154.254.99:/opt/luckyred/bot/handlers/menu.py
scp C:\hbgm001\bot\main.py ubuntu@165.154.254.99:/opt/luckyred/bot/main.py

# ç„¶å SSH è¿æ¥å¹¶é‡å¯
ssh ubuntu@165.154.254.99 "sudo systemctl restart luckyred-bot"
```

## âœ… éªŒè¯æ­¥éª¤

ä¸Šä¼ å¹¶é‡å¯åï¼Œè¯·æµ‹è¯•ï¼š

1. **æµ‹è¯•å›è¦†é”®ç›˜æŒ‰é’®**ï¼ˆåº•éƒ¨é”®ç›˜ï¼‰ï¼š
   - ç‚¹å‡» "ğŸ’° éŒ¢åŒ…" æŒ‰é’®
   - ç‚¹å‡» "ğŸ§§ ç´…åŒ…" æŒ‰é’®
   - ç‚¹å‡» "ğŸ“ˆ è³ºå–" æŒ‰é’®
   - åº”è¯¥éƒ½èƒ½æ­£å¸¸å“åº”

2. **æµ‹è¯•å†…è”é”®ç›˜æŒ‰é’®**ï¼ˆæ¶ˆæ¯ä¸­çš„ç»¿è‰²æŒ‰é’®ï¼‰ï¼š
   - ç‚¹å‡» "ğŸ’° éŒ¢åŒ…" å†…è”æŒ‰é’®
   - ç‚¹å‡» "ğŸ§§ ç´…åŒ…" å†…è”æŒ‰é’®
   - ç‚¹å‡» "ğŸ® éŠæˆ²" å†…è”æŒ‰é’®
   - åº”è¯¥éƒ½èƒ½æ­£å¸¸å“åº”

3. **æµ‹è¯•é”™è¯¯å¤„ç†**ï¼š
   - å¦‚æœå‡ºç°é”™è¯¯ï¼Œåº”è¯¥ä¼šæ”¶åˆ°é”™è¯¯æç¤ºæ¶ˆæ¯
   - ä¸åº”è¯¥å‡ºç°é™é»˜å¤±è´¥çš„æƒ…å†µ

## ğŸ“ ä¿®å¤çš„å…³é”®ç‚¹

1. **å…¨å±€å¼‚å¸¸æ•è·**ï¼šç¡®ä¿æ‰€æœ‰å¼‚å¸¸éƒ½è¢«æ•è·å¹¶è®°å½•
2. **ç”¨æˆ·åé¦ˆ**ï¼šå³ä½¿å‡ºç°é”™è¯¯ï¼Œä¹Ÿè¦ç»™ç”¨æˆ·å‘é€æç¤ºæ¶ˆæ¯
3. **æ—¥å¿—è®°å½•**ï¼šæ‰€æœ‰é”™è¯¯éƒ½ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œæ–¹ä¾¿è°ƒè¯•

## ğŸ” å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

å¦‚æœä¸Šä¼ åé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æ£€æŸ¥ï¼š

1. **Bot æ˜¯å¦æ­£å¸¸è¿è¡Œ**ï¼š
   ```bash
   sudo systemctl status luckyred-bot
   ```

2. **æŸ¥çœ‹ Bot æ—¥å¿—**ï¼š
   ```bash
   sudo journalctl -u luckyred-bot -n 100 --no-pager
   ```

3. **æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æ¶ˆæ¯**ï¼š
   - æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰ `[DEBUG]`ã€`[MENU_CALLBACK]`ã€`[CALLBACK_DEBUG]` ç­‰æ ‡è®°
   - æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸å †æ ˆä¿¡æ¯

4. **ç¡®è®¤æ–‡ä»¶å·²æ­£ç¡®ä¸Šä¼ **ï¼š
   ```bash
   ls -lh /opt/luckyred/bot/handlers/keyboard.py
   ls -lh /opt/luckyred/bot/handlers/menu.py
   ls -lh /opt/luckyred/bot/main.py
   ```

---

**ä¿®å¤å®Œæˆåï¼Œè¯·æµ‹è¯•æ‰€æœ‰æŒ‰é’®åŠŸèƒ½ï¼Œç¡®ä¿éƒ½èƒ½æ­£å¸¸å“åº”ï¼**
