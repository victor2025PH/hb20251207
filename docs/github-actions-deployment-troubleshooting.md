# GitHub Actions è‡ªåŠ¨éƒ¨ç½²æ•…éšœæ’æŸ¥

## ğŸ“‹ å¸¸è§é—®é¢˜

### 1. éƒ¨ç½²å¤±è´¥ä½†æœåŠ¡æ­£å¸¸è¿è¡Œ

**ç—‡çŠ¶**: GitHub Actions æ˜¾ç¤ºå¤±è´¥ï¼ˆçº¢è‰² âŒï¼‰ï¼Œä½†æœåŠ¡å™¨ä¸ŠæœåŠ¡æ­£å¸¸è¿è¡Œ

**åŸå› **: 
- `systemctl status` å‘½ä»¤åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè¿”å›éé›¶é€€å‡ºç 
- `set -e` å¯¼è‡´è„šæœ¬åœ¨é‡åˆ°éé›¶é€€å‡ºç æ—¶ç«‹å³é€€å‡º

**è§£å†³æ–¹æ¡ˆ**: 
- ä½¿ç”¨ `systemctl is-active` æ£€æŸ¥æœåŠ¡çŠ¶æ€
- å¯¹éå…³é”®å‘½ä»¤ä½¿ç”¨ `|| true` é˜²æ­¢è„šæœ¬é€€å‡º
- æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º

---

### 2. Git Pull å†²çª

**ç—‡çŠ¶**: éƒ¨ç½²å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯æ˜¾ç¤º git pull å¤±è´¥

**åŸå› **:
- æœåŠ¡å™¨ä¸Šæœ‰æœ¬åœ°ä¿®æ”¹æœªæäº¤
- åˆ†æ”¯å†å²ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åœ¨éƒ¨ç½²è„šæœ¬ä¸­ä½¿ç”¨å¼ºåˆ¶é‡ç½®
git fetch origin main
git reset --hard origin/main
```

---

### 3. ä¾èµ–å®‰è£…å¤±è´¥

**ç—‡çŠ¶**: pip install å¤±è´¥

**åŸå› **:
- ç½‘ç»œé—®é¢˜
- åŒ…ç‰ˆæœ¬å†²çª
- ç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ·»åŠ é‡è¯•å’Œç¼“å­˜æ¸…ç†
pip install --upgrade pip
pip install -r requirements.txt --no-cache-dir
```

---

### 4. æœåŠ¡é‡å¯å¤±è´¥

**ç—‡çŠ¶**: `systemctl restart` å¤±è´¥

**åŸå› **:
- ä»£ç é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨
- é…ç½®æ–‡ä»¶é”™è¯¯
- ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æœåŠ¡æ—¥å¿—: `sudo journalctl -u hbgm001-backend -n 50`
- éªŒè¯é…ç½®æ–‡ä»¶
- æ£€æŸ¥ç«¯å£å ç”¨: `sudo netstat -tulpn | grep 8080`

---

## ğŸ”§ å½“å‰éƒ¨ç½²è„šæœ¬æ”¹è¿›

### æ”¹è¿›ç‚¹ï¼š

1. **æ›´å¥½çš„é”™è¯¯å¤„ç†**
   - ä½¿ç”¨ `systemctl is-active` æ£€æŸ¥æœåŠ¡çŠ¶æ€
   - å¯¹éå…³é”®å‘½ä»¤ä½¿ç”¨ `|| true`
   - æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

2. **Git æ“ä½œæ”¹è¿›**
   - ä½¿ç”¨ `git reset --hard` ç¡®ä¿ä»£ç åŒæ­¥
   - æ·»åŠ  `git fetch` ç¡®ä¿è·å–æœ€æ–°ä»£ç 

3. **ä¾èµ–å®‰è£…æ”¹è¿›**
   - æ·»åŠ  `--upgrade pip`
   - æ·»åŠ é‡è¯•æœºåˆ¶
   - ä½¿ç”¨ `--no-cache-dir` é€‰é¡¹

4. **æœåŠ¡é‡å¯æ”¹è¿›**
   - æ·»åŠ é‡å¯åç­‰å¾…æ—¶é—´
   - æ£€æŸ¥é‡å¯æ˜¯å¦æˆåŠŸ
   - å¤±è´¥æ—¶æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—

---

## ğŸ“ æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š

- [ ] GitHub Secrets å·²é…ç½®ï¼ˆ`SERVER_HOST`, `SERVER_USER`, `SERVER_SSH_KEY`ï¼‰
- [ ] æœåŠ¡å™¨ SSH å¯†é’¥å·²æ·»åŠ åˆ° GitHub Secrets
- [ ] æœåŠ¡å™¨ä¸Šé¡¹ç›®ç›®å½•å­˜åœ¨ä¸”å¯å†™
- [ ] æœåŠ¡å™¨ä¸Š git ä»“åº“å·²æ­£ç¡®é…ç½®
- [ ] æœåŠ¡å™¨ä¸Š systemd æœåŠ¡å·²é…ç½®

éƒ¨ç½²åæ£€æŸ¥ï¼š

- [ ] æœåŠ¡çŠ¶æ€: `sudo systemctl status hbgm001-backend`
- [ ] æœåŠ¡æ—¥å¿—: `sudo journalctl -u hbgm001-backend -f`
- [ ] API å¯è®¿é—®: `curl http://127.0.0.1:8080/api/health`
- [ ] ä»£ç ç‰ˆæœ¬: `cd /home/ubuntu/hbgm001 && git log -1`

---

## ğŸ› è°ƒè¯•å‘½ä»¤

### æŸ¥çœ‹ GitHub Actions æ—¥å¿—
1. è¿›å…¥ GitHub ä»“åº“
2. ç‚¹å‡» "Actions" æ ‡ç­¾
3. é€‰æ‹©å¤±è´¥çš„ workflow run
4. æŸ¥çœ‹ "Deploy to server" æ­¥éª¤çš„è¯¦ç»†æ—¥å¿—

### æ‰‹åŠ¨æ‰§è¡Œéƒ¨ç½²è„šæœ¬
```bash
# SSH åˆ°æœåŠ¡å™¨
ssh ubuntu@165.154.254.99

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/ubuntu/hbgm001

# æ‰‹åŠ¨æ‰§è¡Œéƒ¨ç½²æ­¥éª¤
git pull origin main
source .venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart hbgm001-backend
sudo systemctl status hbgm001-backend
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl is-active hbgm001-backend

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u hbgm001-backend -n 100 --no-pager

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u hbgm001-backend -f
```

---

## âœ… æˆåŠŸæ ‡å¿—

éƒ¨ç½²æˆåŠŸçš„æ ‡å¿—ï¼š

1. âœ… GitHub Actions æ˜¾ç¤ºç»¿è‰² âœ“
2. âœ… æœåŠ¡çŠ¶æ€: `active (running)`
3. âœ… API å“åº”æ­£å¸¸: `curl http://127.0.0.1:8080/api/health` è¿”å› 200
4. âœ… ä»£ç ç‰ˆæœ¬åŒ¹é…: æœåŠ¡å™¨ä¸Šçš„ commit hash ä¸ GitHub ä¸€è‡´

---

**æœ€åæ›´æ–°**: 2025-12-09

