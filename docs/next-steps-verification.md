# ä¸‹ä¸€æ­¥ï¼šåŠŸèƒ½éªŒè¯ä¸æµ‹è¯•

## ğŸ¯ å½“å‰çŠ¶æ€

âœ… **æ‰€æœ‰ä»£ç å·²éƒ¨ç½²**  
âœ… **æ•°æ®åº“è¿ç§»å·²å®Œæˆ**  
âœ… **å‰ç«¯æ„å»ºæˆåŠŸ**  
âœ… **åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸**  
âœ… **Nginx é…ç½®å·²æ›´æ–°**

---

## ğŸ“‹ åŠŸèƒ½éªŒè¯æ¸…å•

### 1. è®¿é—®åå°ç®¡ç†é¢æ¿

**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š`https://admin.usdt2026.cc`
2. éªŒè¯ï¼š
   - [ ] é¡µé¢æ­£å¸¸åŠ è½½ï¼ˆæ˜¾ç¤ºç™»å½•ç•Œé¢ï¼‰
   - [ ] æ²¡æœ‰ 404 æˆ–é”™è¯¯é¡µé¢
   - [ ] HTTPS è¯ä¹¦æœ‰æ•ˆï¼ˆæµè§ˆå™¨æ˜¾ç¤ºé”å›¾æ ‡ï¼‰

**å¦‚æœé‡åˆ°é—®é¢˜**:
```bash
# æ£€æŸ¥ Nginx é…ç½®
ssh ubuntu@165.154.254.99 "sudo nginx -t"

# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ssh ubuntu@165.154.254.99 "ls -la /home/ubuntu/hbgm001/admin/frontend/dist/"

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
ssh ubuntu@165.154.254.99 "sudo tail -f /var/log/nginx/admin.usdt2026.cc.error.log"
```

---

### 2. ç™»å½•åå°ç®¡ç†é¢æ¿

**æ­¥éª¤**:
1. ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•
2. éªŒè¯ï¼š
   - [ ] ç™»å½•æˆåŠŸ
   - [ ] è·³è½¬åˆ°åå°é¦–é¡µ
   - [ ] å¯ä»¥çœ‹åˆ°æ‰€æœ‰èœå•é¡¹

**å¦‚æœç™»å½•å¤±è´¥**:
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
ssh ubuntu@165.154.254.99 "sudo systemctl status hbgm001-backend"

# æŸ¥çœ‹åç«¯æ—¥å¿—
ssh ubuntu@165.154.254.99 "sudo journalctl -u hbgm001-backend -n 50 --no-pager"
```

---

### 3. æµ‹è¯•çº¢åŒ…é€€æ¬¾åŠŸèƒ½

**æ­¥éª¤**:
1. ç™»å½•åå°ç®¡ç†é¢æ¿
2. è¿›å…¥ **"çº¢åŒ…ç®¡ç†"** é¡µé¢
3. æ‰¾åˆ°ä¸€ä¸ª**æœªé¢†å–**æˆ–**å·²è¿‡æœŸ**çš„çº¢åŒ…
4. ç‚¹å‡» **"é€€æ¬¾"** æŒ‰é’®
5. ç¡®è®¤é€€æ¬¾æ“ä½œ
6. éªŒè¯ï¼š
   - [ ] æ˜¾ç¤º"é€€æ¬¾æˆåŠŸ"æç¤º
   - [ ] çº¢åŒ…çŠ¶æ€å˜ä¸º"å·²é€€æ¬¾"
   - [ ] å‘é€è€…ä½™é¢å·²å¢åŠ ï¼ˆå¯é€šè¿‡"ç”¨æˆ·ç®¡ç†"æŸ¥çœ‹ï¼‰

**API ç«¯ç‚¹**: `POST /api/v1/admin/redpackets/{id}/refund`

---

### 4. æµ‹è¯•äº¤æ˜“ç®¡ç†ä½™é¢åˆ†ç±»

**æ­¥éª¤**:
1. ç™»å½•åå°ç®¡ç†é¢æ¿
2. è¿›å…¥ **"äº¤æ˜“ç®¡ç†"** é¡µé¢
3. æŸ¥çœ‹äº¤æ˜“åˆ—è¡¨
4. éªŒè¯ï¼š
   - [ ] æ¯è¡Œäº¤æ˜“æ˜¾ç¤º **"ä½™é¢åˆ†ç±»"** åˆ—
   - [ ] USDT äº¤æ˜“æ˜¾ç¤ºï¼š
     - **"çœŸå®ä½™é¢"**ï¼ˆç»¿è‰²æ ‡ç­¾ï¼‰
     - **"å¥–åŠ±ä½™é¢"**ï¼ˆæ©™è‰²æ ‡ç­¾ï¼‰
   - [ ] å…¶ä»–å¸ç§ï¼ˆTONã€Starsã€Pointsï¼‰æ˜¾ç¤º "-"

**é¢„æœŸæ•ˆæœ**:
- çœŸå®ä½™é¢ï¼šç”¨æˆ·å……å€¼æˆ–æç°çš„é‡‘é¢
- å¥–åŠ±ä½™é¢ï¼šæ¸¸æˆå¥–åŠ±ã€æ¨èä½£é‡‘ç­‰

---

### 5. æµ‹è¯•æ¨èç³»ç»Ÿé…ç½®

**æ­¥éª¤**:
1. ç™»å½•åå°ç®¡ç†é¢æ¿
2. è¿›å…¥ **"é‚€è¯·ç®¡ç†"** é¡µé¢
3. æ‰¾åˆ° **"ä½£é‡‘é…ç½®"** å¡ç‰‡ï¼ˆåœ¨é¡µé¢é¡¶éƒ¨æˆ–ä¾§è¾¹ï¼‰
4. ä¿®æ”¹é…ç½®ï¼š
   - ä¸€çº§ä½£é‡‘ç‡ï¼š`5%` (0.05)
   - äºŒçº§ä½£é‡‘ç‡ï¼š`2%` (0.02)
   - ä»£ç†å¥–åŠ±é˜ˆå€¼ï¼š`100` (é‚€è¯·äººæ•°)
5. ç‚¹å‡» **"ä¿å­˜é…ç½®"** æŒ‰é’®
6. éªŒè¯ï¼š
   - [ ] æ˜¾ç¤º"ä¿å­˜æˆåŠŸ"æç¤º
   - [ ] åˆ·æ–°é¡µé¢åï¼Œé…ç½®ä»ç„¶å­˜åœ¨
   - [ ] é…ç½®å·²ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆ`system_config` è¡¨ï¼‰

**API ç«¯ç‚¹**: 
- `GET /api/v1/admin/invite/config` - è·å–é…ç½®
- `POST /api/v1/admin/invite/config` - ä¿å­˜é…ç½®

---

### 6. æµ‹è¯•çº¢åŒ…é›¨è°ƒåº¦åŠŸèƒ½

**æ­¥éª¤**:
1. ç™»å½•åå°ç®¡ç†é¢æ¿
2. è¿›å…¥ **"çº¢åŒ…ç®¡ç†"** é¡µé¢
3. ç‚¹å‡» **"è°ƒåº¦çº¢åŒ…é›¨"** æŒ‰é’®ï¼ˆé€šå¸¸åœ¨é¡µé¢é¡¶éƒ¨ï¼‰
4. å¡«å†™è¡¨å•ï¼š
   - **å¼€å§‹æ—¶é—´**ï¼šé€‰æ‹©æœªæ¥æŸä¸ªæ—¶é—´ï¼ˆä¾‹å¦‚ï¼š1å°æ—¶åï¼‰
   - **æ€»é‡‘é¢**ï¼š`100` USDT
   - **çº¢åŒ…æ•°é‡**ï¼š`10`
   - **ç›®æ ‡ç¾¤ç»„ID**ï¼šç•™ç©ºï¼ˆå…¬å¼€çº¢åŒ…ï¼‰æˆ–å¡«å†™ Telegram ç¾¤ç»„ ID
   - **æ¶ˆæ¯**ï¼š`æµ‹è¯•çº¢åŒ…é›¨`
5. ç‚¹å‡» **"ç¡®å®š"** æŒ‰é’®
6. éªŒè¯ï¼š
   - [ ] æ˜¾ç¤º"è°ƒåº¦æˆåŠŸ"æç¤º
   - [ ] è°ƒåº¦è®°å½•å·²åˆ›å»ºï¼ˆå¯åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹ï¼‰

**éªŒè¯è°ƒåº¦è®°å½•**:
```bash
ssh ubuntu@165.154.254.99 "cd /home/ubuntu/hbgm001 && source .venv/bin/activate && python3 -c \"
from shared.database.connection import AsyncSessionLocal
from sqlalchemy import text
import asyncio

async def check():
    async with AsyncSessionLocal() as db:
        result = await db.execute(text('SELECT * FROM scheduled_redpacket_rains ORDER BY created_at DESC LIMIT 5'))
        rows = result.fetchall()
        for row in rows:
            print(f'ID: {row[0]}, å¼€å§‹æ—¶é—´: {row[1]}, æ€»é‡‘é¢: {row[2]}, çŠ¶æ€: {row[8]}')

asyncio.run(check())
\""
```

**API ç«¯ç‚¹**: `POST /api/v1/admin/redpackets/schedule-rain`

---

### 7. ç”Ÿæˆæ¨èå…³ç³»æ ‘æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

**æ­¥éª¤**:
1. åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæµ‹è¯•æ•°æ®è„šæœ¬ï¼š
```bash
ssh ubuntu@165.154.254.99 "cd /home/ubuntu/hbgm001 && source .venv/bin/activate && python3 scripts/py/seed_referral_tree.py"
```

2. éªŒè¯æ•°æ®å·²åˆ›å»ºï¼š
```bash
ssh ubuntu@165.154.254.99 "cd /home/ubuntu/hbgm001 && source .venv/bin/activate && python3 -c \"
from shared.database.connection import AsyncSessionLocal
from sqlalchemy import text
import asyncio

async def check():
    async with AsyncSessionLocal() as db:
        result = await db.execute(text(\"SELECT username, invited_by_id FROM users WHERE username LIKE 'test_%' ORDER BY username\"))
        rows = result.fetchall()
        print('æµ‹è¯•ç”¨æˆ·åˆ—è¡¨:')
        for row in rows:
            print(f'  {row[0]} (é‚€è¯·äººID: {row[1]})')

asyncio.run(check())
\""
```

3. åœ¨åå°ç®¡ç†é¢æ¿ä¸­éªŒè¯ï¼š
   - è¿›å…¥ **"é‚€è¯·ç®¡ç†"** é¡µé¢
   - åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·ï¼ˆusername ä»¥ `test_` å¼€å¤´ï¼‰
   - ç‚¹å‡» **"æŸ¥çœ‹å…³ç³»æ ‘"** æŒ‰é’®
   - éªŒè¯ï¼š
     - [ ] å…³ç³»æ ‘æ­£å¸¸æ˜¾ç¤º
     - [ ] å¯ä»¥çœ‹åˆ°3å±‚æ¨èå…³ç³»
     - [ ] æ¯ä¸ªèŠ‚ç‚¹æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·åã€ä½™é¢ã€ç­‰çº§ç­‰ï¼‰

**æ¨èå…³ç³»ç»“æ„**:
```
test_root_user
  â”œâ”€â”€ test_user_1
  â”‚   â”œâ”€â”€ test_user_1_1
  â”‚   â””â”€â”€ test_user_1_2
  â””â”€â”€ test_user_2
      â””â”€â”€ test_user_2_1
```

---

## ğŸ” é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æ— æ³•è®¿é—®åå°ç®¡ç†é¢æ¿

**æ£€æŸ¥æ¸…å•**:
- [ ] Nginx æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status nginx`
- [ ] SSL è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼š`sudo certbot certificates`
- [ ] å‰ç«¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š`ls -la /home/ubuntu/hbgm001/admin/frontend/dist/`
- [ ] Nginx é…ç½®æ˜¯å¦æ­£ç¡®ï¼š`sudo nginx -t`

### é—®é¢˜2: API è¯·æ±‚å¤±è´¥

**æ£€æŸ¥æ¸…å•**:
- [ ] åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status hbgm001-backend`
- [ ] åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼š`sudo journalctl -u hbgm001-backend -n 50`
- [ ] API ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®ï¼š`curl http://127.0.0.1:8080/api/v1/admin/health`

### é—®é¢˜3: æ•°æ®åº“æ“ä½œå¤±è´¥

**æ£€æŸ¥æ¸…å•**:
- [ ] æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL`
- [ ] è¡¨æ˜¯å¦å­˜åœ¨ï¼š`psql -U postgres -d hbgm001 -c "\dt"`
- [ ] è¿ç§»æ˜¯å¦å·²æ‰§è¡Œï¼šæ£€æŸ¥ `scheduled_redpacket_rains` è¡¨æ˜¯å¦å­˜åœ¨

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# åç«¯æœåŠ¡çŠ¶æ€
ssh ubuntu@165.154.254.99 "sudo systemctl status hbgm001-backend"

# Nginx çŠ¶æ€
ssh ubuntu@165.154.254.99 "sudo systemctl status nginx"

# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
ssh ubuntu@165.154.254.99 "htop"
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
ssh ubuntu@165.154.254.99 "sudo journalctl -u hbgm001-backend -f"

# Nginx è®¿é—®æ—¥å¿—
ssh ubuntu@165.154.254.99 "sudo tail -f /var/log/nginx/admin.usdt2026.cc.access.log"

# Nginx é”™è¯¯æ—¥å¿—
ssh ubuntu@165.154.254.99 "sudo tail -f /var/log/nginx/admin.usdt2026.cc.error.log"
```

---

## âœ… å®Œæˆæ ‡å‡†

æ‰€æœ‰åŠŸèƒ½éªŒè¯å®Œæˆåï¼Œåº”è¯¥æ»¡è¶³ï¼š

- [x] åå°ç®¡ç†é¢æ¿å¯ä»¥æ­£å¸¸è®¿é—®
- [x] å¯ä»¥æ­£å¸¸ç™»å½•
- [x] çº¢åŒ…é€€æ¬¾åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] äº¤æ˜“ç®¡ç†æ˜¾ç¤ºä½™é¢åˆ†ç±»
- [x] æ¨èç³»ç»Ÿé…ç½®å¯ä»¥ä¿å­˜å’Œè¯»å–
- [x] çº¢åŒ…é›¨è°ƒåº¦åŠŸèƒ½å¯ä»¥åˆ›å»ºè°ƒåº¦è®°å½•
- [x] æ¨èå…³ç³»æ ‘å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼ˆå¦‚æœç”Ÿæˆäº†æµ‹è¯•æ•°æ®ï¼‰

---

**ä¸‹ä¸€æ­¥**: å®ŒæˆåŠŸèƒ½éªŒè¯åï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ç³»ç»Ÿè¿›è¡Œå®é™…è¿è¥ï¼

