# 🧪 任务红包系统 - 功能测试指南

## ✅ 当前状态

从测试结果看：
- ✅ API路由已注册（405说明路由存在，只是HEAD方法不支持）
- ✅ 服务运行正常
- ✅ 代码已更新

## 🚀 立即测试（在服务器上执行）

```bash
cd /opt/luckyred

# 运行完整测试
chmod +x scripts/sh/test-all-functions.sh
bash scripts/sh/test-all-functions.sh
```

## 📋 功能测试清单

### 1. API路由测试

```bash
# 测试任务API（使用GET方法，不是HEAD）
curl http://localhost:8080/api/v1/tasks/status
# 应该返回 401 (需要认证) 或 JSON 数据

# 测试分享API
curl -X POST http://localhost:8080/api/v1/share/record
# 应该返回 401 (需要认证)

# 测试推荐红包API
curl http://localhost:8080/api/v1/redpackets/recommended
# 应该返回 401 (需要认证) 或 JSON 数据
```

### 2. 前端测试

1. **访问任务页面**
   - 打开浏览器访问：`https://mini.usdt2026.cc/tasks`
   - 检查页面是否正常加载
   - 检查任务列表是否显示

2. **检查任务显示**
   - 每日任务应该显示5个
   - 成就任务应该显示5个
   - 每个任务应该显示进度条和奖励信息

### 3. 功能测试

#### 3.1 签到任务测试

1. 打开MiniApp
2. 进入签到页面，完成签到
3. 进入任务页面 (`/tasks`)
4. 检查"每日签到"任务：
   - ✅ 应该显示为"已完成"
   - ✅ 应该显示"领取"按钮
5. 点击"领取"按钮
6. ✅ 应该成功领取任务红包
7. ✅ 余额应该增加

#### 3.2 抢红包任务测试

1. 打开红包列表页面
2. 领取一个红包
3. 进入任务页面
4. 检查"抢红包"任务：
   - ✅ 应该显示为"已完成"
   - ✅ 应该显示"领取"按钮
5. 点击"领取"按钮
6. ✅ 应该成功领取任务红包

#### 3.3 发红包任务测试

1. 打开发红包页面
2. 发送一个红包
3. 进入任务页面
4. 检查"发红包"任务：
   - ✅ 应该显示为"已完成"
   - ✅ 应该显示"领取"按钮
5. 点击"领取"按钮
6. ✅ 应该成功领取任务红包

#### 3.4 邀请任务测试

1. 通过邀请链接邀请一个新用户
2. 新用户完成注册
3. 邀请人进入任务页面
4. 检查"邀请好友"任务：
   - ✅ 应该显示为"已完成"
   - ✅ 应该显示"领取"按钮
5. 点击"领取"按钮
6. ✅ 应该成功领取任务红包

#### 3.5 分享任务测试

1. 调用分享API或点击分享按钮
2. 进入任务页面
3. 检查"分享应用"任务：
   - ✅ 应该显示为"已完成"
   - ✅ 应该显示"领取"按钮
4. 点击"领取"按钮
5. ✅ 应该成功领取任务红包

#### 3.6 成就任务测试

1. **邀请达人**：邀请5个好友
   - ✅ 检查"邀请达人"任务是否完成
   - ✅ 可以领取2 USDT奖励

2. **邀请大师**：邀请10个好友
   - ✅ 检查"邀请大师"任务是否完成
   - ✅ 可以领取5 USDT奖励

3. **抢包达人**：领取10个红包
   - ✅ 检查"抢包达人"任务是否完成
   - ✅ 可以领取1 USDT奖励

4. **发包达人**：发送10个红包
   - ✅ 检查"发包达人"任务是否完成
   - ✅ 可以领取2 USDT奖励

5. **签到达人**：连续签到7天
   - ✅ 检查"签到达人"任务是否完成
   - ✅ 可以领取1 USDT奖励

### 4. 推荐红包测试

1. 访问红包列表页面
2. ✅ 检查是否显示推荐红包
3. ✅ 新用户应该优先看到任务红包
4. ✅ 活跃用户应该优先看到高价值红包

## 🔍 问题排查

### 如果任务页面无法访问

```bash
# 检查前端文件
ls -la /opt/luckyred/frontend/dist/

# 检查Nginx配置
nginx -t
sudo systemctl status nginx

# 检查前端路由
grep -r "tasks" /opt/luckyred/frontend/src/App.tsx
```

### 如果任务不自动完成

```bash
# 查看API日志
sudo journalctl -u luckyred-api -f

# 检查任务完成标记函数
grep -r "mark_task_complete" /opt/luckyred/api/routers/

# 检查数据库
python3 scripts/py/test_tasks_api.py
```

### 如果API返回404

```bash
# 检查路由注册
grep -n "tasks" /opt/luckyred/api/main.py

# 重启API服务
sudo systemctl restart luckyred-api

# 检查API日志
sudo journalctl -u luckyred-api -n 50 | grep -i error
```

## 📊 测试结果记录

测试完成后，记录以下信息：

- [ ] API路由测试通过
- [ ] 前端页面可以访问
- [ ] 签到任务自动完成
- [ ] 抢红包任务自动完成
- [ ] 发红包任务自动完成
- [ ] 邀请任务自动完成
- [ ] 分享任务自动完成
- [ ] 任务红包可以领取
- [ ] 成就任务可以完成
- [ ] 推荐红包功能正常

## 🎉 完成

所有测试通过后，任务红包系统就可以正常使用了！

