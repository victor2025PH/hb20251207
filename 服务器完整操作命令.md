# ğŸš€ æœåŠ¡å™¨å®Œæ•´æ“ä½œå‘½ä»¤

## ğŸ“¥ ç¬¬ä¸€æ­¥ï¼šä»GitHubæ‹‰å–æœ€æ–°ä»£ç 

```bash
cd /opt/luckyred

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# å¦‚æœé‡åˆ°å†²çªï¼Œå…ˆstashæœ¬åœ°æ›´æ”¹
git stash
git pull origin master
git stash pop || true
```

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šä¿®å¤ç­¾åˆ°å’Œä»»åŠ¡é—®é¢˜

```bash
# é‡å¯APIæœåŠ¡ï¼ˆåŠ è½½æ–°ä»£ç ï¼‰
sudo systemctl restart luckyred-api
sleep 5

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api --no-pager | head -10
```

## ğŸ§ª ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•åŠŸèƒ½

```bash
# 1. æµ‹è¯•ä»»åŠ¡APIï¼ˆè¿”å›401æ˜¯æ­£å¸¸çš„ï¼Œéœ€è¦è®¤è¯ï¼‰
curl http://localhost:8080/api/v1/tasks/status

# 2. æ£€æŸ¥æ•°æ®åº“è¡¨
cd /opt/luckyred/api
source .venv/bin/activate
cd /opt/luckyred
python3 << 'EOF'
import sys
sys.path.insert(0, '.')
from sqlalchemy import inspect
from shared.database.connection import sync_engine

inspector = inspect(sync_engine)
tables = inspector.get_table_names()

print("æ•°æ®åº“è¡¨æ£€æŸ¥:")
for table in ['task_completions', 'red_packets', 'users']:
    if table in tables:
        print(f"âœ“ {table} å­˜åœ¨")
    else:
        print(f"âœ— {table} ä¸å­˜åœ¨")

if 'red_packets' in tables:
    columns = [col['name'] for col in inspector.get_columns('red_packets')]
    for field in ['visibility', 'source_type', 'task_type']:
        if field in columns:
            print(f"âœ“ red_packets.{field} å­˜åœ¨")
        else:
            print(f"âœ— red_packets.{field} ä¸å­˜åœ¨")
EOF
deactivate

# 3. æµ‹è¯•æ¨¡å—å¯¼å…¥
cd /opt/luckyred/api
source .venv/bin/activate
cd /opt/luckyred
python3 << 'EOF'
import sys
sys.path.insert(0, '.')
from api.routers import tasks
print(f"âœ“ tasksæ¨¡å—å¯¼å…¥æˆåŠŸ")
print(f"  æ¯æ—¥ä»»åŠ¡: {len(tasks.DAILY_TASKS)} ä¸ª")
print(f"  æˆå°±ä»»åŠ¡: {len(tasks.ACHIEVEMENT_TASKS)} ä¸ª")
EOF
deactivate

# 4. æŸ¥çœ‹APIæ—¥å¿—ï¼ˆæ£€æŸ¥é”™è¯¯ï¼‰
sudo journalctl -u luckyred-api -n 50 | grep -i "error\|exception" | head -10
```

## ğŸ“‹ ä¸€é”®æ‰§è¡Œï¼ˆå¤åˆ¶ç²˜è´´å…¨éƒ¨ï¼‰

```bash
cd /opt/luckyred && \
git pull origin master && \
sudo systemctl restart luckyred-api && \
sleep 5 && \
echo "âœ… ä»£ç å·²æ›´æ–°ï¼ŒæœåŠ¡å·²é‡å¯" && \
echo "ğŸ“‹ æµ‹è¯•API:" && \
curl -I http://localhost:8080/api/v1/tasks/status
```

## ğŸ” å¦‚æœGit pullå¤±è´¥

### æƒ…å†µ1ï¼šæœ‰æœ¬åœ°æ›´æ”¹å†²çª

```bash
cd /opt/luckyred
git stash
git pull origin master
git stash pop || true
sudo systemctl restart luckyred-api
```

### æƒ…å†µ2ï¼šGitä»“åº“æœªåˆå§‹åŒ–

```bash
cd /opt/luckyred
# å¦‚æœ.gitä¸å­˜åœ¨ï¼Œéœ€è¦å…‹éš†
if [ ! -d ".git" ]; then
    cd /opt
    mv luckyred luckyred_backup
    git clone https://github.com/victor2025PH/hoongbao1127.git luckyred
    # ç„¶åå¤åˆ¶é…ç½®æ–‡ä»¶
    cp luckyred_backup/.env luckyred/.env 2>/dev/null || true
fi
```

### æƒ…å†µ3ï¼šéœ€è¦è¾“å…¥GitHubå‡­æ®

```bash
# å¦‚æœæç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œå¯ä»¥é…ç½®SSHå¯†é’¥æˆ–ä½¿ç”¨token
# æˆ–è€…ä½¿ç”¨HTTPS URLï¼ˆå¦‚æœå·²é…ç½®å‡­æ®ï¼‰
git pull origin master
```

## ğŸ“± å‰ç«¯æµ‹è¯•

1. è®¿é—®ï¼š`https://mini.usdt2026.cc/tasks`
2. æ£€æŸ¥ä»»åŠ¡åˆ—è¡¨æ˜¯å¦æ˜¾ç¤º
3. æµ‹è¯•ç­¾åˆ°åŠŸèƒ½
4. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è‡ªåŠ¨å®Œæˆ

