# ğŸš€ æœåŠ¡å™¨æ­£ç¡®æ“ä½œæ­¥éª¤

## âš ï¸ é‡è¦ï¼šå¿…é¡»åœ¨æ­£ç¡®çš„ç›®å½•æ‰§è¡Œå‘½ä»¤

**é¡¹ç›®ç›®å½•ï¼š** `/opt/luckyred`

## ğŸ“‹ å®Œæ•´æ“ä½œæ­¥éª¤

### 1. è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /opt/luckyred
```

**âš ï¸ ä¸è¦åœ¨å…¶ä»–ç›®å½•æ‰§è¡Œå‘½ä»¤ï¼**

### 2. æ‹‰å–æœ€æ–°ä»£ç 

```bash
cd /opt/luckyred
git pull origin master
```

### 3. ä¿®å¤æƒé™å¹¶æ„å»ºå‰ç«¯

```bash
cd /opt/luckyred

# ä¿®å¤æƒé™
sudo chown -R $USER:$USER frontend
sudo chmod -R 755 frontend
if [ -d frontend/dist ]; then
    sudo chown -R $USER:$USER frontend/dist
    sudo chmod -R 755 frontend/dist
fi

# æ„å»ºå‰ç«¯
cd frontend
npm run build
cd ..
```

### 4. æ£€æŸ¥APIé”™è¯¯

```bash
cd /opt/luckyred
chmod +x scripts/sh/check-api-error.sh
bash scripts/sh/check-api-error.sh
```

### 5. é‡å¯APIæœåŠ¡

```bash
sudo systemctl restart luckyred-api

# ç­‰å¾…3ç§’åæ£€æŸ¥çŠ¶æ€
sleep 3
sudo systemctl status luckyred-api
```

### 6. æµ‹è¯•API

```bash
# æµ‹è¯•checkin APIï¼ˆåº”è¯¥è¿”å›401ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰
curl http://localhost:8080/api/v1/checkin/status

# æµ‹è¯•tasks APIï¼ˆåº”è¯¥è¿”å›401ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰
curl http://localhost:8080/api/v1/tasks/status
```

## ğŸ”§ æˆ–è€…ä½¿ç”¨ä¸€é”®ä¿®å¤è„šæœ¬

```bash
cd /opt/luckyred
git pull origin master
chmod +x scripts/sh/fix-all-issues.sh
bash scripts/sh/fix-all-issues.sh
```

## ğŸ› å¦‚æœAPIå¯åŠ¨å¤±è´¥

### æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

```bash
cd /opt/luckyred
chmod +x scripts/sh/check-api-error.sh
bash scripts/sh/check-api-error.sh
```

### æˆ–è€…æ‰‹åŠ¨æŸ¥çœ‹

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api -l

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u luckyred-api -n 100 --no-pager | tail -50

# å°è¯•æ‰‹åŠ¨å¯åŠ¨ï¼ˆæŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼‰
cd /opt/luckyred/api
source .venv/bin/activate
cd /opt/luckyred
python3 -m uvicorn api.main:app --host 127.0.0.1 --port 8080
```

## âœ… éªŒè¯æ­¥éª¤

1. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   sudo systemctl status luckyred-api
   ```
   åº”è¯¥æ˜¾ç¤º `Active: active (running)`

2. **æµ‹è¯•API**
   ```bash
   curl http://localhost:8080/api/v1/checkin/status
   ```
   åº”è¯¥è¿”å› `{"detail":"Telegram user ID is required"}`ï¼ˆ401æ˜¯æ­£å¸¸çš„ï¼Œéœ€è¦è®¤è¯ï¼‰

3. **æ£€æŸ¥å‰ç«¯**
   ```bash
   ls -la /opt/luckyred/frontend/dist/
   ```
   åº”è¯¥çœ‹åˆ° `index.html` å’Œ `assets/` ç›®å½•

## ğŸ“ å¸¸è§é”™è¯¯

### é”™è¯¯1: `fatal: not a git repository`
**åŸå› **ï¼šä¸åœ¨é¡¹ç›®ç›®å½•ä¸­
**è§£å†³**ï¼šæ‰§è¡Œ `cd /opt/luckyred` åå†æ‰§è¡Œå‘½ä»¤

### é”™è¯¯2: `cannot access 'frontend': No such file or directory`
**åŸå› **ï¼šä¸åœ¨é¡¹ç›®ç›®å½•ä¸­
**è§£å†³**ï¼šæ‰§è¡Œ `cd /opt/luckyred` åå†æ‰§è¡Œå‘½ä»¤

### é”™è¯¯3: `APIæœåŠ¡å¯åŠ¨å¤±è´¥`
**åŸå› **ï¼šä»£ç æœ‰è¯­æ³•é”™è¯¯æˆ–ç¼ºå°‘å¯¼å…¥
**è§£å†³**ï¼šè¿è¡Œ `bash scripts/sh/check-api-error.sh` æŸ¥çœ‹è¯¦ç»†é”™è¯¯

### é”™è¯¯4: `EACCES: permission denied`
**åŸå› **ï¼šæ–‡ä»¶æƒé™é—®é¢˜
**è§£å†³**ï¼šæ‰§è¡Œæƒé™ä¿®å¤å‘½ä»¤ï¼ˆè§æ­¥éª¤3ï¼‰

