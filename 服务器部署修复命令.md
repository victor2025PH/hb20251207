# ğŸ”§ æœåŠ¡å™¨éƒ¨ç½²ä¿®å¤å‘½ä»¤

## å½“å‰é—®é¢˜

1. âœ… Gitåˆå¹¶å†²çª
2. âœ… APIè·¯ç”±è¿”å›404
3. âœ… Botå†²çªæ£€æµ‹

## å¿«é€Ÿä¿®å¤ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

```bash
cd /opt/luckyred

# 1. è§£å†³Gitå†²çª
git stash
git pull origin master
git stash pop || true

# 2. ç¡®ä¿APIè™šæ‹Ÿç¯å¢ƒæœ‰ä¾èµ–
cd /opt/luckyred/api
source .venv/bin/activate
pip install -q sqlalchemy psycopg2-binary fastapi uvicorn
cd /opt/luckyred

# 3. è¿è¡Œæ•°æ®åº“è¿ç§»
python3 migrations/add_task_redpacket_system.py

# 4. æ„å»ºå‰ç«¯
cd /opt/luckyred/frontend
npm install
npm run build

# 5. åœæ­¢Botï¼ˆè§£å†³å†²çªï¼‰
sudo systemctl stop luckyred-bot
sleep 2

# 6. é‡å¯æœåŠ¡
sudo systemctl restart luckyred-api
sudo systemctl restart luckyred-bot

# 7. ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 5

# 8. æµ‹è¯•APIè·¯ç”±
curl -I http://localhost:8080/api/v1/tasks/status
# åº”è¯¥è¿”å› 401 (éœ€è¦è®¤è¯) æˆ– 200ï¼Œä¸æ˜¯ 404

# 9. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api
sudo systemctl status luckyred-bot
```

## æˆ–è€…ä½¿ç”¨ä¿®å¤è„šæœ¬

```bash
cd /opt/luckyred
git pull origin master
chmod +x scripts/sh/resolve-conflicts-and-deploy.sh
bash scripts/sh/resolve-conflicts-and-deploy.sh
```

## éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥APIè·¯ç”±
curl http://localhost:8080/api/v1/tasks/status
# åº”è¯¥è¿”å› 401 (éœ€è¦è®¤è¯) æˆ– JSON æ•°æ®

# 2. æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /opt/luckyred/frontend/dist/index.html

# 3. è®¿é—®ä»»åŠ¡é¡µé¢
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: https://mini.usdt2026.cc/tasks

# 4. æŸ¥çœ‹APIæ—¥å¿—
sudo journalctl -u luckyred-api -f
```

## å¦‚æœAPIä»ç„¶è¿”å›404

æ£€æŸ¥è·¯ç”±æ³¨å†Œï¼š

```bash
# æ£€æŸ¥api/main.pyä¸­æ˜¯å¦æœ‰tasksè·¯ç”±
grep -n "tasks" /opt/luckyred/api/main.py

# åº”è¯¥çœ‹åˆ°ï¼š
# app.include_router(tasks.router, prefix="/api/v1/tasks", tags=["ä»»å‹™"])

# å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ æˆ–é‡æ–°æ‹‰å–ä»£ç 
```

