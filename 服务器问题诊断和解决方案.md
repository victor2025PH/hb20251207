# ğŸ” æœåŠ¡å™¨é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ“Š å½“å‰é—®é¢˜åˆ†æ

### é—®é¢˜1ï¼šAPI æœåŠ¡è¿æ¥å¤±è´¥

**ç°è±¡**ï¼š
```bash
curl http://localhost:8080/health
curl: (7) Failed to connect to localhost port 8080
```

**å¯èƒ½åŸå› **ï¼š
1. æœåŠ¡åˆšé‡å¯ï¼Œè¿˜åœ¨å¯åŠ¨ä¸­ï¼ˆéœ€è¦ç­‰å¾…å‡ ç§’ï¼‰
2. æœåŠ¡å¯åŠ¨å¤±è´¥
3. ç«¯å£è¢«å ç”¨æˆ–é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### æ­¥éª¤1ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u luckyred-api -n 50

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u luckyred-api | grep -i error
```

#### æ­¥éª¤2ï¼šç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨

æœåŠ¡å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ‰èƒ½å®Œå…¨å¯åŠ¨ã€‚ç­‰å¾… 5-10 ç§’åé‡è¯•ï¼š

```bash
# ç­‰å¾… 5 ç§’åé‡è¯•
sleep 5
curl http://localhost:8080/health
```

#### æ­¥éª¤3ï¼šæ£€æŸ¥ç«¯å£ç›‘å¬

```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦åœ¨ç›‘å¬
sudo netstat -tlnp | grep 8080
# æˆ–
sudo ss -tlnp | grep 8080
```

#### æ­¥éª¤4ï¼šæ‰‹åŠ¨å¯åŠ¨æµ‹è¯•

```bash
# è¿›å…¥ API ç›®å½•
cd /opt/luckyred/api
source .venv/bin/activate

# æ‰‹åŠ¨å¯åŠ¨ï¼ˆæµ‹è¯•ï¼‰
uvicorn main:app --host 127.0.0.1 --port 8080
```

å¦‚æœæ‰‹åŠ¨å¯åŠ¨æˆåŠŸï¼Œè¯´æ˜ä»£ç æ²¡é—®é¢˜ï¼Œå¯èƒ½æ˜¯ systemd é…ç½®é—®é¢˜ã€‚

---

### é—®é¢˜2ï¼šå‰ç«¯è®¤è¯å¤±è´¥

**ç°è±¡**ï¼š
- åœ¨æµè§ˆå™¨ä¸­è®¿é—® `mini.usdt2026.cc` æ—¶æ˜¾ç¤º"è®¤è¯å¤±è´¥"
- æç¤º"æ— æ³•è·å–Telegramè®¤è¯ä¿¡æ¯ï¼Œè¯·ç¡®ä¿åœ¨Telegramä¸­æ‰“å¼€æ­¤åº”ç”¨"

**åŸå› åˆ†æ**ï¼š
- åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®æ—¶ï¼Œåº”è¯¥æ˜¾ç¤º Web ç™»å½•ç•Œé¢ï¼Œè€Œä¸æ˜¯"è®¤è¯å¤±è´¥"
- å¯èƒ½æ˜¯ `detectPlatform()` é”™è¯¯åœ°æ£€æµ‹ä¸º Telegram ç¯å¢ƒ
- æˆ–è€… `useAuth` çš„åˆå§‹åŒ–é€»è¾‘æœ‰é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### æ–¹æ¡ˆ1ï¼šæ£€æŸ¥å¹³å°æ£€æµ‹é€»è¾‘

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥ï¼š
```javascript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œæ‰§è¡Œï¼š
window.Telegram?.WebApp
// å¦‚æœè¿”å› undefinedï¼Œè¯´æ˜ä¸åœ¨ Telegram ç¯å¢ƒ
```

#### æ–¹æ¡ˆ2ï¼šæ”¹è¿› AuthGuard é€»è¾‘

å¦‚æœç¡®å®åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼Œåº”è¯¥æ˜¾ç¤º WebLoginScreen è€Œä¸æ˜¯"è®¤è¯å¤±è´¥"ã€‚

---

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

### 1. æ£€æŸ¥å¹¶é‡å¯ API æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api

# å¦‚æœæœåŠ¡æœªè¿è¡Œæˆ–æœ‰é—®é¢˜ï¼Œé‡å¯
sudo systemctl restart luckyred-api

# ç­‰å¾… 5 ç§’
sleep 5

# å†æ¬¡æ£€æŸ¥
sudo systemctl status luckyred-api

# æµ‹è¯•è¿æ¥
curl http://localhost:8080/health
```

### 2. æ£€æŸ¥ Nginx é…ç½®

```bash
# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æ£€æŸ¥ Nginx æ˜¯å¦æ­£åœ¨è¿è¡Œ
sudo systemctl status nginx

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 3. æ£€æŸ¥å‰ç«¯æ–‡ä»¶

```bash
# æ£€æŸ¥å‰ç«¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /opt/luckyred/frontend/dist/

# æ£€æŸ¥æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /opt/luckyred/frontend/dist
```

### 4. æŸ¥çœ‹å®Œæ•´æ—¥å¿—

```bash
# API æ—¥å¿—
sudo journalctl -u luckyred-api -f

# Nginx è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

---

## ğŸ¯ é¢„æœŸç»“æœ

### API å¥åº·æ£€æŸ¥

æˆåŠŸæ—¶åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2025-12-06T...",
  "service": "luckyred-api",
  "version": "1.0.0"
}
```

### å‰ç«¯è®¿é—®

- **åœ¨ Telegram ä¸­æ‰“å¼€**ï¼šåº”è¯¥è‡ªåŠ¨ç™»å½•
- **åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€**ï¼šåº”è¯¥æ˜¾ç¤º Web ç™»å½•ç•Œé¢ï¼ˆGoogle/Wallet/Magic Linkï¼‰

---

## ğŸ“ å¸¸è§é—®é¢˜æ’æŸ¥

### API æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# 1. æ£€æŸ¥ Python ç¯å¢ƒ
cd /opt/luckyred/api
source .venv/bin/activate
python3 --version

# 2. æ£€æŸ¥ä¾èµ–
pip list | grep fastapi

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /opt/luckyred/.env | grep -v "PASSWORD\|SECRET\|TOKEN"

# 4. æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
python3 -c "from api.main import app; print('OK')"
```

### å‰ç«¯è®¤è¯é—®é¢˜

å¦‚æœæµè§ˆå™¨ä¸­æ˜¾ç¤º"è®¤è¯å¤±è´¥"ï¼š

1. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆF12ï¼‰
   - æŸ¥çœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯
   - æ£€æŸ¥ `window.Telegram` æ˜¯å¦å­˜åœ¨

2. **æ£€æŸ¥ API è¿æ¥**
   - æ‰“å¼€ Network æ ‡ç­¾
   - æŸ¥çœ‹ API è¯·æ±‚æ˜¯å¦æˆåŠŸ
   - æ£€æŸ¥å“åº”çŠ¶æ€ç 

3. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5ï¼‰
   - æ¸…é™¤ç¼“å­˜å’Œ Cookie

---

## ğŸš€ å®Œæ•´è¯Šæ–­å‘½ä»¤

```bash
# 1. æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status luckyred-api luckyred-bot nginx

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep -E "8080|80|443"

# 3. æµ‹è¯• API è¿æ¥
curl -v http://localhost:8080/health

# 4. æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
cat /etc/nginx/sites-enabled/mini.usdt2026.cc.conf

# 5. æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
sudo journalctl -u luckyred-api -n 100 | tail -20
sudo journalctl -u luckyred-bot -n 100 | tail -20
sudo tail -20 /var/log/nginx/error.log
```

---

## âœ… éªŒè¯æ¸…å•

- [ ] API æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] ç«¯å£ 8080 æ­£åœ¨ç›‘å¬
- [ ] å¥åº·æ£€æŸ¥è¿”å›æˆåŠŸ
- [ ] Nginx é…ç½®æ­£ç¡®
- [ ] å‰ç«¯æ–‡ä»¶å­˜åœ¨ä¸”æƒé™æ­£ç¡®
- [ ] æµè§ˆå™¨ä¸­å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] è®¤è¯é€»è¾‘æ­£å¸¸å·¥ä½œ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. **æ”¶é›†è¯Šæ–­ä¿¡æ¯**ï¼š
   ```bash
   # è¿è¡Œå®Œæ•´è¯Šæ–­
   bash scripts/sh/test-deployment.sh
   ```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**ï¼š
   ```bash
   sudo journalctl -u luckyred-api -n 200
   ```

3. **æ£€æŸ¥é…ç½®æ–‡ä»¶**ï¼š
   ```bash
   # æ£€æŸ¥ .env æ–‡ä»¶
   cat /opt/luckyred/.env | grep -E "DATABASE_URL|BOT_TOKEN|API_BASE_URL"
   ```

