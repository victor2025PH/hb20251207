# 🧪 立即测试步骤

## ✅ 当前状态

从日志看：
- ✅ API服务已成功启动
- ✅ 数据库已初始化
- ⚠️ 有一些警告（WebSocket、SyntaxWarning），但不影响任务功能

## 🚀 立即测试（在服务器上执行）

```bash
cd /opt/luckyred

# 运行测试脚本
chmod +x scripts/sh/test-tasks-now.sh
bash scripts/sh/test-tasks-now.sh
```

## 📱 前端测试

1. **访问任务页面**
   - 打开浏览器或MiniApp
   - 访问：`https://mini.usdt2026.cc/tasks`
   - ✅ 应该显示任务列表

2. **测试签到功能**
   - 打开MiniApp
   - 进入签到页面
   - 完成签到
   - ✅ 应该不再出错
   - ✅ 进入任务页面，检查"每日签到"任务是否显示

3. **检查任务显示**
   - 访问任务页面
   - ✅ 应该显示5个每日任务：
     - 每日签到
     - 抢红包
     - 发红包
     - 分享应用
     - 邀请好友
   - ✅ 应该显示5个成就任务（如果已完成）

## 🔍 如果任务不显示

### 检查API日志

```bash
# 查看最近的错误
sudo journalctl -u luckyred-api -n 100 | grep -i error

# 查看实时日志
sudo journalctl -u luckyred-api -f
```

### 测试API直接调用

```bash
# 测试任务API（需要认证，返回401是正常的）
curl http://localhost:8080/api/v1/tasks/status

# 如果返回404，检查路由注册
grep -n "tasks" /opt/luckyred/api/main.py
```

### 检查数据库

```bash
cd /opt/luckyred/api
source .venv/bin/activate
cd /opt/luckyred
python3 scripts/py/test_tasks_api.py
```

## 🐛 常见问题

### 问题1: 任务页面显示"Not Found"

**原因**：前端路由未正确配置或API返回错误

**解决**：
```bash
# 检查前端路由
grep -r "tasks" /opt/luckyred/frontend/src/App.tsx

# 检查API日志
sudo journalctl -u luckyred-api -f
```

### 问题2: 签到出错

**原因**：任务完成标记时数据库会话问题

**解决**：已修复，重启API服务后应该正常

### 问题3: 任务不显示

**原因**：任务API返回错误或空列表

**解决**：
```bash
# 检查API日志
sudo journalctl -u luckyred-api -n 100 | grep -i "task\|error"

# 测试API
curl http://localhost:8080/api/v1/tasks/status
```

## ✅ 验证清单

- [ ] API服务运行正常
- [ ] 任务API路由可访问（返回401或200）
- [ ] 数据库表已创建
- [ ] 前端任务页面可以访问
- [ ] 签到功能不再出错
- [ ] 任务列表显示正常
- [ ] 完成任务后任务状态更新

