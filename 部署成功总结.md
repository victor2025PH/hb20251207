# ğŸ‰ éƒ¨ç½²æˆåŠŸæ€»ç»“

## âœ… æœåŠ¡çŠ¶æ€

### API æœåŠ¡
- **çŠ¶æ€**: `active (running)` âœ…
- **å¥åº·æ£€æŸ¥**: `{"status":"ok", "app":"LuckyRed", "version":"1.0.0"}` âœ…
- **ç«¯å£**: `127.0.0.1:8080` âœ…
- **è¿›ç¨‹**: uvicorn æ­£å¸¸è¿è¡Œ âœ…

### å¯åŠ¨æ—¥å¿—
```
INFO: Started server process [1116430]
INFO: Application startup complete.
INFO: Uvicorn running on http://127.0.0.1:8080
INFO | main:lifespan:61 Starting LuckyRed API v1.0.0
INFO | main:lifespan:65 âœ” Database initialized
```

---

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. å¾ªç¯å¯¼å…¥é—®é¢˜ âœ…
- **é—®é¢˜**: `ImportError: cannot import name 'create_access_token' from partially initialized module`
- **è§£å†³**: å°† `create_access_token`ã€`TokenResponse`ã€`UserResponse` ç§»åˆ° `api/utils/auth_utils.py`

### 2. Python è·¯å¾„é—®é¢˜ âœ…
- **é—®é¢˜**: `ModuleNotFoundError: No module named 'api'`
- **è§£å†³**: åœ¨ systemd æœåŠ¡é…ç½®ä¸­æ·»åŠ  `PYTHONPATH=/opt/luckyred`

### 3. ç¼ºå¤±ä¾èµ–é—®é¢˜ âœ…
- **é—®é¢˜**: `ImportError: email-validator is not installed`
- **è§£å†³**: åœ¨ `requirements.txt` ä¸­æ·»åŠ  `email-validator` å’Œ `pydantic[email]`

### 4. Router å±æ€§ç¼ºå¤± âœ…
- **é—®é¢˜**: `AttributeError: module 'api.routers.auth' has no attribute 'router'`
- **è§£å†³**: åœ¨ `api/routers/auth/__init__.py` ä¸­æ­£ç¡®å¯¼å‡º `router`

### 5. Feedback æ¨¡å—æœªå¯¼å…¥ âœ…
- **é—®é¢˜**: `NameError: name 'feedback' is not defined`
- **è§£å†³**: åœ¨ `api/main.py` ä¸­æ·»åŠ  `feedback` æ¨¡å—å¯¼å…¥

---

## âš ï¸ éè‡´å‘½è­¦å‘Šï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

ä»¥ä¸‹è­¦å‘Šä¸å½±å“åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥åç»­ä¼˜åŒ–ï¼š

### 1. Redis æœªå®‰è£…ï¼ˆå¯é€‰ï¼‰
```
WARNING: Rate limit middleware not available: No module named 'redis'
WARNING: redisæ¨¡å—æœªå®‰è£…,å°†ä½¿ç”¨æ•°æ®åº“æ¨¡å¼(ä¸å½±å“åŸºæœ¬åŠŸèƒ½)
```

**å¦‚æœéœ€è¦é€Ÿç‡é™åˆ¶åŠŸèƒ½**ï¼š
```bash
cd /opt/luckyred/api
source .venv/bin/activate
pip install redis
sudo systemctl restart luckyred-api
```

### 2. WebSocket è·¯ç”±ä¸å¯ç”¨ï¼ˆå¯é€‰ï¼‰
```
WARNING: WebSocket router not available: cannot import name 'verify_telegram_init_data'
```

è¿™æ˜¯å¯é€‰çš„ WebSocket åŠŸèƒ½ï¼Œä¸å½±å“åŸºæœ¬ API åŠŸèƒ½ã€‚

---

## ğŸš€ éªŒè¯æ¸…å•

- [x] API æœåŠ¡æ­£å¸¸è¿è¡Œ
- [x] å¥åº·æ£€æŸ¥é€šè¿‡
- [x] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [x] æ‰€æœ‰è·¯ç”±å·²æ³¨å†Œ
- [x] å‰ç«¯å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] Redis ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
- [ ] WebSocket åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

---

## ğŸ“Š æœåŠ¡ä¿¡æ¯

### å½“å‰è¿è¡ŒçŠ¶æ€
- **æœåŠ¡åç§°**: `luckyred-api.service`
- **è¿è¡Œç”¨æˆ·**: `www-data`
- **å·¥ä½œç›®å½•**: `/opt/luckyred/api`
- **è™šæ‹Ÿç¯å¢ƒ**: `/opt/luckyred/api/.venv`
- **ç›‘å¬åœ°å€**: `127.0.0.1:8080`
- **è¿›ç¨‹ ID**: åŠ¨æ€åˆ†é…
- **å†…å­˜ä½¿ç”¨**: ~124MB
- **CPU ä½¿ç”¨**: æ­£å¸¸

### å¥åº·æ£€æŸ¥ç«¯ç‚¹
```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# è¯¦ç»†å¥åº·æ£€æŸ¥
curl http://localhost:8080/health/detailed

# ç³»ç»ŸæŒ‡æ ‡
curl http://localhost:8080/health/metrics
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³æ‰§è¡Œ
1. **æµ‹è¯•å‰ç«¯è®¿é—®**
   - è®¿é—® `https://mini.usdt2026.cc`
   - éªŒè¯ç™»å½•åŠŸèƒ½
   - æµ‹è¯•ä¸»è¦åŠŸèƒ½

2. **ç›‘æ§æœåŠ¡çŠ¶æ€**
   ```bash
   # å®æ—¶æŸ¥çœ‹æ—¥å¿—
   sudo journalctl -u luckyred-api -f
   ```

### å¯é€‰ä¼˜åŒ–
1. **å®‰è£… Redis**ï¼ˆå¦‚æœéœ€è¦é€Ÿç‡é™åˆ¶å’Œç¼“å­˜ï¼‰
   ```bash
   sudo apt-get install redis-server
   cd /opt/luckyred/api
   source .venv/bin/activate
   pip install redis
   sudo systemctl restart luckyred-api
   ```

2. **é…ç½®ç›‘æ§å‘Šè­¦**
   - è®¾ç½®å¥åº·æ£€æŸ¥ç›‘æ§
   - é…ç½®é”™è¯¯å‘Šè­¦

3. **æ€§èƒ½ä¼˜åŒ–**
   - è¿è¡Œæ…¢æŸ¥è¯¢åˆ†æ
   - ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
   - æ·»åŠ  Redis ç¼“å­˜

---

## ğŸ“ é‡è¦æ–‡ä»¶

### æœåŠ¡é…ç½®
- `/etc/systemd/system/luckyred-api.service` - systemd æœåŠ¡é…ç½®
- `/opt/luckyred/.env` - ç¯å¢ƒå˜é‡é…ç½®

### ä»£ç ä½ç½®
- `/opt/luckyred/api/` - API ä»£ç 
- `/opt/luckyred/frontend/dist/` - å‰ç«¯æ„å»ºæ–‡ä»¶
- `/opt/luckyred/bot/` - Bot ä»£ç 

### æ—¥å¿—ä½ç½®
- API æ—¥å¿—: `sudo journalctl -u luckyred-api`
- Nginx æ—¥å¿—: `/var/log/nginx/access.log` å’Œ `/var/log/nginx/error.log`

---

## âœ… éƒ¨ç½²å®Œæˆï¼

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œã€‚ç³»ç»Ÿç°åœ¨å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡äº†ï¼ğŸ‰

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²è¿ç»´æ–‡æ¡£](./docs/éƒ¨ç½²è¿ç»´æ–‡æ¡£.md)
- [API æ¥å£æ–‡æ¡£](./docs/APIæ¥å£æ–‡æ¡£.md)
- [æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨åŠ å›ºæŒ‡å—](./docs/æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨åŠ å›ºæŒ‡å—.md)
- [502é”™è¯¯å¿«é€Ÿä¿®å¤æŒ‡å—](./502é”™è¯¯å¿«é€Ÿä¿®å¤æŒ‡å—.md)

